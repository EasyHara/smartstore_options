<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</title>
  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /* ë°•ìŠ¤ ëª¨ë¸ í†µì¼ */
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      background: #f5f6fa;
      color: #333;
    }

    .container {
      max-width: 100%;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      overflow-x: auto;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }

    /* ê°€ì´ë“œ ë°•ìŠ¤ */
    .guide {
      position: relative;
      background: #f8f9fc;
      padding: 16px 20px;
      margin-bottom: 24px;
      border-radius: 10px;
      line-height: 1.6;
      box-shadow: 0 0 0 1px #e5e7eb;
    }
    .guide a.github {
      position: absolute;
      top: 12px;
      right: 16px;
      background: #f8f9fc;
      color: #2563eb;
      font-weight: 500;
      font-size: 14px;
      text-decoration: none;
      padding: 4px 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
    }
    .guide strong { display: block; margin-bottom: 8px; font-size: 15px; color: #1f2937; }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    table {
      width: 100%;
      min-width: 1200px;
      border-collapse: collapse;
      margin: 10px 0;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      word-break: break-word;
      vertical-align: middle;
    }
    th { background: #f0f0f0; }

    /* ê³µí†µ ë²„íŠ¼/ì…ë ¥ ìŠ¤íƒ€ì¼ */
    button, input[type="file"], input[type="number"], input[type="text"] {
      margin: 4px;
      padding: 6px 10px;
      font-size: 14px;
      height: 36px;
      vertical-align: middle;
    }

    /* ì…ë ¥ë°•ìŠ¤ í…Œë‘ë¦¬ ì œê±° */
    #inputTable td input[type="text"],
    #inputTable td input[type="number"] {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      padding: 4px 6px;
    }

    /* ì¹¼ëŸ¼ ë„ˆë¹„ ì§€ì • */
    #inputTable th:nth-child(1), #inputTable td:nth-child(1) { width: 5%; }
    #inputTable th:nth-child(2), #inputTable td:nth-child(2) { width: 5%; }
    #inputTable th:nth-child(3), #inputTable td:nth-child(3) { width: 20%; }
    #inputTable th:nth-child(4), #inputTable td:nth-child(4) { width: 15%; }
    #inputTable th:nth-child(5), #inputTable td:nth-child(5) { width: 15%; }
    #inputTable th:nth-child(6), #inputTable td:nth-child(6) { width: 15%; }
    #inputTable th:nth-child(7), #inputTable td:nth-child(7) { width: 15%; }
    #inputTable th:nth-child(8), #inputTable td:nth-child(8) { width: 10%; }
    #inputTable th:nth-child(9), #inputTable td:nth-child(9) { width: 5%; }

    /* í• ì¸ë¥  ì…ë ¥ì°½ */
    #discountRate {
      width: 50px;
      padding: 4px 6px;
      height: 28px;
      font-size: 14px;
    }

    /* ì„ íƒ ê°•ì¡° */
    .selected { background: rgba(0,123,255,0.1); }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ƒ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</h1>

    <!-- íŒŒì¼ ì—…ë¡œë“œ & í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ -->
    <input type="file" id="inputFile" accept=".xls,.xlsx">
    <button onclick="downloadTemplate()">ì—‘ì…€ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>

    <!-- ì‚¬ì´ì¦ˆ ì…ë ¥ ë°©ë²• ì•ˆë‚´ + GitHub ë§í¬ -->
    <div class="guide">
      <a href="https://github.com/EasyHara/smartstore_options/blob/main/smartstore_options.html"
         class="github" target="_blank">ì›¹ íŒŒì¼</a>
      <strong>ì‚¬ì´ì¦ˆ ì…ë ¥ ë°©ë²• ì•ˆë‚´</strong>
      <ul style="margin:0; padding-left:20px; font-size:14px;">
        <li><strong>ë²”ìœ„ ì…ë ¥:</strong> <code>230~240</code> â†’ 5ë‹¨ìœ„ ìë™ ìƒì„± (ì˜ˆ: 230, 235, 240)</li>
        <li><strong>ê°œë³„ ì…ë ¥:</strong> <code>230,235/245</code> â†’ ì‰¼í‘œ ë˜ëŠ” ìŠ¬ë˜ì‹œë¡œ ì§ì ‘ ì§€ì •</li>
        <li>ë„¤ì´ë²„ ê·œì •ì— ë”°ë¼ ë¯¸ë‹¬Â·ì´ˆê³¼ ì˜µì…˜ì€ ë‹¤ìš´ë¡œë“œ ì‹œ ìë™ ì œê±°ë©ë‹ˆë‹¤</li>
      </ul>
    </div>

    <!-- ì˜µì…˜ ë…¸ì¶œ ë°©ì‹ / í• ì¸ë¥  -->
    <div style="margin-bottom:24px;">
      <span>ì˜µì…˜ ë…¸ì¶œ ë°©ì‹:</span>
      <label><input type="radio" name="optionDisplay" value="both" checked> ìƒ‰ìƒ&ì‚¬ì´ì¦ˆ ëª¨ë‘</label>
      <label><input type="radio" name="optionDisplay" value="colorOnly"> ìƒ‰ìƒë§Œ</label>
      <label><input type="radio" name="optionDisplay" value="sizeOnly"> ì‚¬ì´ì¦ˆë§Œ</label>
      <label style="margin-left:20px;">ì˜µì…˜ê°€ ê³„ì‚° í• ì¸ë¥  (%)</label>
      <input type="number" id="discountRate" value="0" min="0" max="99">%
    </div>

    <!-- ì˜µì…˜ í…Œì´ë¸” -->
    <table id="inputTable">
      <thead>
        <tr>
          <th>ì´ë™</th>
          <th>ëŒ€í‘œ</th>
          <th>ìƒí’ˆëª…</th>
          <th>íŒë§¤ê°€(ë„¤ì´ë²„í• ì¸ê°€)</th>
          <th>ìƒ‰ìƒ</th>
          <th>ì‚¬ì´ì¦ˆ</th>
          <th>1ë²ˆ ìƒí’ˆëª…</th>
          <th>í’ˆì ˆëœ ì¡°í•©</th>
          <th>ì œì™¸</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- í–‰ ì¶”ê°€ / ì¡°ì‘ ë²„íŠ¼ -->
    <button onclick="addRow()">+ í–‰ ì¶”ê°€</button>
    <button onclick="clearTable()">ì´ˆê¸°í™”</button>
    <button onclick="resetOrder()">ìˆœì„œ ì´ˆê¸°í™”</button>
    <button onclick="moveSelectedToTop()">ë§¨ ìœ„ë¡œ</button>
    <button onclick="moveSelectedUp()">ìœ„ë¡œ</button>
    <button onclick="moveSelectedDown()">ì•„ë˜ë¡œ</button>
    <button onclick="moveSelectedToBottom()">ë§¨ ì•„ë˜ë¡œ</button>

    <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <div style="text-align:center; margin-top:20px;">
      <button onclick="downloadRepresentative()">ì„ íƒìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="generateZip()">ì¼ê´„ ZIP ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadAddProductExcel()">ì¶”ê°€ìƒí’ˆ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadSingleProductExcel()">ë‹¨í’ˆë“±ë¡ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadSingleProductExcelAll()">ë‹¨í’ˆ ì „ì²´ ZIP</button>
      <button onclick="downloadOrderedTemplate()">ìˆœì„œë°˜ì˜ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </div>

  <script>
      // 1) tbody ì—ë§Œ ë“œë˜ê·¸ ìˆœì„œ ë³€ê²½ í™œì„±í™”
  Sortable.create(document.querySelector('#inputTable tbody'), {
    animation: 150,
    handle: 'td',    // ì…€ ì–´ë””ë“  ì¡ê³  ë“œë˜ê·¸
  });

  // 2) í…Œì´ë¸” ë°ì´í„°ë¥¼ ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹ ì–‘ì‹ìœ¼ë¡œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
  function downloadOrderedTemplate() {
    // í—¤ë” (ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹ê³¼ ë™ì¼)
    const headers = ["ìƒí’ˆëª…","íŒë§¤ê°€","ìƒ‰ìƒ","ì‚¬ì´ì¦ˆ","1ë²ˆ ìƒí’ˆëª…","í’ˆì ˆëœ ì¡°í•©","ì œì™¸"];
    // í˜„ì¬ í™”ë©´ì˜ ìˆœì„œëŒ€ë¡œ ë°ì´í„° ìˆ˜ì§‘
    const data = Array.from(document.querySelectorAll('#inputTable tbody tr')).map(row => {
      const inputs = row.querySelectorAll('input');
      return [
        inputs[2].value.trim(),                  // ìƒí’ˆëª…
        parseInt(inputs[3].value) || 0,          // íŒë§¤ê°€
        inputs[4].value.trim(),                  // ìƒ‰ìƒ
        inputs[5].value.trim(),                  // ì‚¬ì´ì¦ˆ
        inputs[6].value.trim(),                  // 1ë²ˆ ìƒí’ˆëª…
        inputs[7].value.trim(),                  // í’ˆì ˆëœ ì¡°í•©
        inputs[8].checked ? 'Y' : ''             // ì œì™¸(Y/ë¹ˆë¬¸ì)
      ];
    });

    // ì—‘ì…€ ìƒì„±
    const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ìƒí’ˆì˜µì…˜");
    const blob = new Blob(
      [XLSX.write(wb, { bookType: 'xls', type: 'array' })],
      { type: 'application/octet-stream' }
    );
    saveAs(blob, 'ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹-ìˆœì„œë°˜ì˜.xls');
  }
    let originalData = [];

    // í–‰ ì¶”ê°€
    function addRow(data = {}) {
      const tbody = document.querySelector('#inputTable tbody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><input type="checkbox" class="to-move"></td>
        <td><input type="radio" name="ëŒ€í‘œ"></td>
        <td><input value="${data.ìƒí’ˆëª…||''}"></td>
        <td><input type="number" value="${data.íŒë§¤ê°€||''}"></td>
        <td><input value="${data.ìƒ‰ìƒ||''}"></td>
        <td><input value="${data.ì‚¬ì´ì¦ˆ||''}"></td>
        <td><input value="${data['1ë²ˆ ìƒí’ˆëª…']||''}"></td>
        <td><input value="${data.í’ˆì ˆëœì¡°í•©||''}"></td>
        <td><input type="checkbox" ${data.ì œì™¸?'checked':''}></td>
      `;
      tbody.appendChild(row);
    }

    // í…Œì´ë¸” ì´ˆê¸°í™”
    function clearTable() {
      document.querySelector('#inputTable tbody').innerHTML = '';
    }

    // ì›ë˜ ìˆœì„œ ë³µì›
    function resetOrder() {
      clearTable();
      originalData.forEach(d => addRow(d));
    }

    // í˜„ì¬ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì½ì–´ì„œ ê°ì²´ ë°°ì—´ ë¦¬í„´
    function getDataFromTable() {
      return Array.from(document.querySelectorAll('#inputTable tbody tr')).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
          ëŒ€í‘œ:     inputs[1].checked,
          ìƒí’ˆëª…:   inputs[2].value.trim(),
          íŒë§¤ê°€:   parseInt(inputs[3].value)||0,
          ìƒ‰ìƒ:     inputs[4].value.trim(),
          ì‚¬ì´ì¦ˆ:   inputs[5].value.trim(),
          ['1ë²ˆ ìƒí’ˆëª…']: inputs[6].value.trim(),
          í’ˆì ˆëœì¡°í•©: inputs[7].value.trim(),
          ì œì™¸:     inputs[8].checked
        };
      });
    }

    // ì„ íƒëœ í–‰ì„ ìœ„ë¡œ/ì•„ë˜ë¡œ ì´ë™
    function moveSelectedUp() {
      const tbody = document.querySelector('#inputTable tbody');
      Array.from(tbody.querySelectorAll('tr')).forEach(row => {
        const cb = row.querySelector('.to-move');
        if (cb && cb.checked) {
          const prev = row.previousElementSibling;
          if (prev) tbody.insertBefore(row, prev);
        }
      });
    }
    function moveSelectedDown() {
      const tbody = document.querySelector('#inputTable tbody');
      Array.from(tbody.querySelectorAll('tr')).reverse().forEach(row => {
        const cb = row.querySelector('.to-move');
        if (cb && cb.checked) {
          const next = row.nextElementSibling;
          if (next) tbody.insertBefore(next, row);
        }
      });
    }
    // ì„ íƒëœ í–‰ì„ ë§¨ ìœ„ë¡œ ì´ë™
function moveSelectedToTop() {
  const tbody = document.querySelector('#inputTable tbody');
  // ì„ íƒëœ trë“¤ì„ ë°°ì—´ë¡œ, ìœ„â†’ì•„ë˜ ìˆœì„œë¡œ ìˆœíšŒ
  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    const cb = row.querySelector('.to-move');
    if (cb && cb.checked) {
      tbody.insertBefore(row, tbody.firstElementChild);
    }
  });
}

// ì„ íƒëœ í–‰ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™
function moveSelectedToBottom() {
  const tbody = document.querySelector('#inputTable tbody');
  // ì„ íƒëœ trë“¤ì„ ë°°ì—´ë¡œ, ì•„ë˜â†’ìœ„ ìˆœì„œë¡œ ìˆœíšŒí•´ì•¼ ìˆœì„œ ê¼¬ì„ ë°©ì§€
  Array.from(tbody.querySelectorAll('tr')).reverse().forEach(row => {
    const cb = row.querySelector('.to-move');
    if (cb && cb.checked) {
      tbody.appendChild(row);
    }
  });
}

    // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
    function downloadTemplate() {
      const headers = ['ìƒí’ˆëª…','íŒë§¤ê°€','ìƒ‰ìƒ','ì‚¬ì´ì¦ˆ','1ë²ˆ ìƒí’ˆëª…','í’ˆì ˆëœ ì¡°í•©','ì œì™¸'];
      const ws = XLSX.utils.aoa_to_sheet([headers]);
      const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'ìƒí’ˆì˜µì…˜');
      const blob = new Blob([XLSX.write(wb,{bookType:'xls',type:'array'})],{type:'application/octet-stream'});
      saveAs(blob,'ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹.xls');
    }

    // ì—…ë¡œë“œ íŒŒì¼ ì½ê¸° & ì›ë³¸ ì €ì¥
    document.getElementById('inputFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => {
        const data = new Uint8Array(evt.target.result);
        const wb = XLSX.read(data,{type:'array'});
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet,{defval:''});
        clearTable();
        json.forEach(r => addRow({
          ìƒí’ˆëª…: r['ìƒí’ˆëª…'],
          íŒë§¤ê°€: r['íŒë§¤ê°€'],
          ìƒ‰ìƒ:   r['ìƒ‰ìƒ'],
          ì‚¬ì´ì¦ˆ: r['ì‚¬ì´ì¦ˆ'],
          '1ë²ˆ ìƒí’ˆëª…': r['1ë²ˆ ìƒí’ˆëª…'],
          í’ˆì ˆëœì¡°í•©: r['í’ˆì ˆëœ ì¡°í•©']||'',
          ì œì™¸: r['ì œì™¸']==='Y'
        }));
        originalData = getDataFromTable();
      };
      reader.readAsArrayBuffer(file);
    });
      // ë„¤ì´ë²„ ì˜µì…˜ê°€ ìœ íš¨ì„± ê²€ì‚¬
  function isValidOptionPrice(basePrice, diff) {
    if (basePrice < 2000) return diff >= 0 && diff <= basePrice;
    if (basePrice < 10000) return diff >= -basePrice * 0.5 && diff <= basePrice;
    return diff >= -basePrice * 0.5 && diff <= basePrice * 0.5;
  }

  // í• ì¸ë¥  ê¸°ì¤€ ì›ê°€ ê³„ì‚°
  function calculateOriginalPrice(salePrice, discountRate) {
    const raw = salePrice / (1 - discountRate / 100);
    return Math.round(raw / 100) * 100;
  }

  // ì˜µì…˜ ë¬¸ìì—´ â†’ ë°°ì—´
  function parseOptions(str) {
    if (!str) return [];
    return str.toString().split(/[,/]/).map(s => s.trim()).filter(Boolean);
  }

  // ì‚¬ì´ì¦ˆ expand (ì˜ˆ: "230~240" â†’ [230,235,240])
  function expandSizes(sizeStr) {
    if (!sizeStr) return [];
    if (/[~,ï¼]/.test(sizeStr)) {
      const [start, end] = sizeStr.split(/~|ï¼/).map(n=>parseInt(n,10));
      const arr = [];
      for (let s = start; s <= end; s += 5) arr.push(s.toString());
      return arr;
    }
    return sizeStr.split(/[,/]/).map(s=>s.trim()).filter(Boolean);
  }
    
// ëŒ€í‘œìƒí’ˆ ê¸°ì¤€ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
function downloadRepresentative() {
  // 1) í˜„ì¬ í…Œì´ë¸”ì˜ ìˆœì„œëŒ€ë¡œ, ì œì™¸ëœ í•­ëª©ì€ ë¹¼ê³  ê°€ì ¸ì˜¤ê¸°
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) {
    alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // 2) ëŒ€í‘œìƒí’ˆ ì°¾ê¸° (ì²´í¬ëœ í•­ëª© í˜¹ì€ ì²« ë²ˆì§¸)
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];

  // 3) í• ì¸ë¥  & ëŒ€í‘œì •ê°€ ê³„ì‚°
  const í• ì¸ë¥  = parseFloat(document.getElementById("discountRate").value) || 0;
  const ëŒ€í‘œì •ê°€ = calculateOriginalPrice(ëŒ€í‘œ.íŒë§¤ê°€, í• ì¸ë¥ );

  // 4) ì˜µì…˜ ë…¸ì¶œ ëª¨ë“œ
  const mode = getOptionDisplayMode();

  // 5) ëŒ€í‘œìƒí’ˆì„ ë§¨ ì•ì—, ë‚˜ë¨¸ì§€ëŠ” ì›ë˜ ìˆœì„œ ê·¸ëŒ€ë¡œ
  const ordered = [
    ëŒ€í‘œ,
    ...rows.filter(r => r !== ëŒ€í‘œ)
  ];

  // 6) ì˜µì…˜ ë°ì´í„° ìƒì„±
  let data = [];
  ordered.forEach(item => {
    const ì˜µì…˜ê°€ = item.íŒë§¤ê°€ - ëŒ€í‘œ.íŒë§¤ê°€;
    if (!isValidOptionPrice(ëŒ€í‘œì •ê°€, ì˜µì…˜ê°€)) return;

    // ìƒí’ˆëª… + 1ë²ˆ ìƒí’ˆëª… ì²˜ë¦¬
    const nm = (item === ëŒ€í‘œ && item["1ë²ˆ ìƒí’ˆëª…"] && item["1ë²ˆ ìƒí’ˆëª…"] !== item.ìƒí’ˆëª…)
      ? `${item.ìƒí’ˆëª….split(" ")[0]} ${item["1ë²ˆ ìƒí’ˆëª…"]}`
      : item.ìƒí’ˆëª…;

    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ).length ? parseOptions(item.ìƒ‰ìƒ) : [""];
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);

    ìƒ‰ìƒëª©ë¡.forEach(col => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        data.push({
          ...applyOptionMode(nm, col, null, nm, ""),
          ì˜µì…˜ê°€,
          ì¬ê³ ìˆ˜ëŸ‰: 99999,
          ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(sz => {
          data.push({
            ...applyOptionMode(nm, col, sz, nm, ""),
            ì˜µì…˜ê°€,
            ì¬ê³ ìˆ˜ëŸ‰: 99999,
            ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        });
      }
    });
  });

  // 7) ì¤‘ë³µ ì œê±°
  {
    const seen = new Set();
    data = data.filter(r => {
      const key = [r.ê´€ë¦¬ì½”ë“œ, r.ì˜µì…˜ê°€, r.ìƒ‰ìƒ||"", r.ì‚¬ì´ì¦ˆ||""].join("|");
      if (seen.has(key)) return false;
      seen.add(key);
      return true;
    });
  }

  // 8) ê´€ë¦¬ì½”ë“œë³„ ìˆœë²ˆ ë§¤í•‘
  const seqMap = {};
  data.forEach(r => {
    if (!(r.ê´€ë¦¬ì½”ë“œ in seqMap)) {
      seqMap[r.ê´€ë¦¬ì½”ë“œ] = Object.keys(seqMap).length + 1;
    }
  });

  // 9) ìˆœë²ˆ ë¶™ì´ê¸°
  data = data.map(r => {
    const seq = String(seqMap[r.ê´€ë¦¬ì½”ë“œ]).padStart(2, "0");
    return { ...r, ì œí’ˆì„ íƒ: `${seq}) ${r.ì œí’ˆì„ íƒ}` };
  });

  // 10) ëª¨ë“œë³„ ì»¬ëŸ¼ ì •ë¦¬
  if (mode === "colorOnly") data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);
  if (mode === "sizeOnly")  data.forEach(r => delete r.ìƒ‰ìƒ);
  if (mode !== "colorOnly" && !data.some(r => r.ì‚¬ì´ì¦ˆ)) {
    data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);
  }

  // 11) ì—‘ì…€ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");

  const blob = new Blob(
    [XLSX.write(wb, { bookType: "xls", type: "array" })],
    { type: "application/octet-stream" }
  );
  saveAs(blob, `${ëŒ€í‘œ.ìƒí’ˆëª…}.xls`);
} 
// ì¼ê´„ ZIP ë‹¤ìš´ë¡œë“œ
  // 1) ì œì™¸ë˜ì§€ ì•Šì€ í˜„ì¬ í…Œì´ë¸” ìˆœì„œëŒ€ë¡œ ê°€ì ¸ì˜¤ê¸°
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (!rows.length) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const í• ì¸ë¥  = parseFloat(document.getElementById("discountRate").value) || 0;
  const mode = getOptionDisplayMode();
  const zip  = new JSZip();

  rows.forEach(ëŒ€í‘œ => {
    const ëŒ€í‘œì •ê°€ = calculateOriginalPrice(ëŒ€í‘œ.íŒë§¤ê°€, í• ì¸ë¥ );

    // 2) ëŒ€í‘œìƒí’ˆ ë§¨ ì•ì—, ë‚˜ë¨¸ì§€ëŠ” rows ë°°ì—´ì˜ ìˆœì„œ ê·¸ëŒ€ë¡œ
    const orderedItems = [
      ëŒ€í‘œ,
      ...rows.filter(r => r !== ëŒ€í‘œ)
    ];

    // 3) orderedItems ìˆœì„œëŒ€ë¡œ ì˜µì…˜ë°ì´í„° ìƒì„±
    let data = [];
    orderedItems.forEach(item => {
      const ì˜µì…˜ê°€ = item.íŒë§¤ê°€ - ëŒ€í‘œ.íŒë§¤ê°€;
      if (!isValidOptionPrice(ëŒ€í‘œì •ê°€, ì˜µì…˜ê°€)) return;

      const nm = (item===ëŒ€í‘œ && item["1ë²ˆ ìƒí’ˆëª…"] && item["1ë²ˆ ìƒí’ˆëª…"]!==item.ìƒí’ˆëª…)
        ? `${item.ìƒí’ˆëª….split(" ")[0]} ${item["1ë²ˆ ìƒí’ˆëª…"]}`
        : item.ìƒí’ˆëª…;

      const cols = parseOptions(item.ìƒ‰ìƒ).length ? parseOptions(item.ìƒ‰ìƒ) : [""];
      const szs  = expandSizes(item.ì‚¬ì´ì¦ˆ);

      cols.forEach(col => {
        if (szs.length === 0) {
          data.push({
            ...applyOptionMode(nm, col, null, nm, ""),
            ì˜µì…˜ê°€, ì¬ê³ ìˆ˜ëŸ‰:99999, ê´€ë¦¬ì½”ë“œ:item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€:"Y"
          });
        } else {
          szs.forEach(sz => {
            data.push({
              ...applyOptionMode(nm, col, sz, nm, ""),
              ì˜µì…˜ê°€, ì¬ê³ ìˆ˜ëŸ‰:99999, ê´€ë¦¬ì½”ë“œ:item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€:"Y"
            });
          });
        }
      });
    });

    // ì¤‘ë³µ ì œê±°
    {
      const seen = new Set();
      data = data.filter(r => {
        const key = [r.ê´€ë¦¬ì½”ë“œ, r.ì˜µì…˜ê°€, r.ìƒ‰ìƒ||"", r.ì‚¬ì´ì¦ˆ||""].join("|");
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });
    }

    // ìˆœë²ˆ ë§¤í•‘
    const seqMap = {};
    data.forEach(r => {
      if (!(r.ê´€ë¦¬ì½”ë“œ in seqMap)) seqMap[r.ê´€ë¦¬ì½”ë“œ] = Object.keys(seqMap).length + 1;
    });

    // ìˆœë²ˆ ë¶™ì´ê¸°
    data = data.map(r => {
      const seq = String(seqMap[r.ê´€ë¦¬ì½”ë“œ]).padStart(2, "0");
      return { ...r, ì œí’ˆì„ íƒ: `${seq}) ${r.ì œí’ˆì„ íƒ}` };
    });

    // ëª¨ë“œë³„ ì •ë¦¬
    if (mode === "colorOnly") data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);
    if (mode === "sizeOnly")  data.forEach(r => delete r.ìƒ‰ìƒ);
    if (mode !== "colorOnly" && !data.some(r => r.ì‚¬ì´ì¦ˆ)) data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);

    // ZIPì— ì¶”ê°€
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");
    const out = XLSX.write(wb, { bookType: "xls", type: "array" });
    zip.file(`${ëŒ€í‘œ.ìƒí’ˆëª…}.xls`, out);
  });

  zip.generateAsync({ type: "blob" }).then(blob => saveAs(blob, "ì˜µì…˜_ì¼ê´„ë‹¤ìš´ë¡œë“œ.zip"));
}
    
// ì¶”ê°€ìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ëª¨ë“  ì œì™¸ë˜ì§€ ì•Šì€ ìƒí’ˆ í¬í•¨)
function downloadAddProductExcel() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];

  // 1) ìš°ì„  ì•„ì´í…œë³„ ë°ì´í„° ìˆ˜ì§‘
  const items = rows.sort((a, b) => (a === ëŒ€í‘œ ? -1 : b === ëŒ€í‘œ ? 1 : 0));
  let data = [];
  let index = 1;

  items.forEach(item => {
    const ìˆœë²ˆ = index < 10 ? `0${index}` : `${index}`;
    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);
    const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length > 0 ? ìƒ‰ìƒëª©ë¡ : [""];

    ìƒ‰ìƒë°°ì—´.forEach(color => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        data.push({
          ì¶”ê°€ìƒí’ˆëª…: "ì œí’ˆì„ íƒ",
          ì¶”ê°€ìƒí’ˆê°’: `${ìˆœë²ˆ}) ${item.ìƒí’ˆëª…} / ${color}`.trim(),
          ì¶”ê°€ìƒí’ˆê°€: item.íŒë§¤ê°€,
          ì¬ê³ ìˆ˜ëŸ‰: 99999,
          ì‚¬ìš©ì—¬ë¶€: "Y",
          ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…
        });
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          data.push({
            ì¶”ê°€ìƒí’ˆëª…: "ì œí’ˆì„ íƒ",
            ì¶”ê°€ìƒí’ˆê°’: `${ìˆœë²ˆ}) ${item.ìƒí’ˆëª…} / ${color}${size}`.trim(), // ì‚¬ì´ì¦ˆë„ keyì— í¬í•¨
            ì¶”ê°€ìƒí’ˆê°€: item.íŒë§¤ê°€,
            ì¬ê³ ìˆ˜ëŸ‰: 99999,
            ì‚¬ìš©ì—¬ë¶€: "Y",
            ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…
          });
        });
      }
    });

    index++;
  });

  // 2) ì¤‘ë³µ ì œê±°: ì¶”ê°€ìƒí’ˆê°’(=ìˆœë²ˆ) ê¸°ì¤€ìœ¼ë¡œ í•œ ë²ˆë§Œ ë‚¨ê¸°ê¸°
  {
    const seen = new Set();
    data = data.filter(row => {
      if (seen.has(row.ì¶”ê°€ìƒí’ˆê°’)) return false;
      seen.add(row.ì¶”ê°€ìƒí’ˆê°’);
      return true;
    });
  }

  // 3) ì‹œíŠ¸ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì¶”ê°€ìƒí’ˆ");
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  const safeName = ëŒ€í‘œ.ìƒí’ˆëª….replace(/[\\/:*?"<>|]/g, "").trim();
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ì¶”ê°€ìƒí’ˆ_${safeName}.xls`);
}
// ë‹¨í’ˆë“±ë¡ìš© ì—‘ì…€ ë‹¤ìš´ë¡œë“œ - ëŒ€í‘œìƒí’ˆë§Œ ìˆœë²ˆ ì—†ì´ ì¶œë ¥  
function downloadSingleProductExcel() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  if (!ëŒ€í‘œ) return alert("ëŒ€í‘œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");

  const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
  const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
  const í’ˆì ˆì¡°í•© = parseOptions(ëŒ€í‘œ.í’ˆì ˆëœì¡°í•©);
  const ìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;
  const mode = getOptionDisplayMode();

  const data = [];

  ìƒ‰ìƒëª©ë¡.forEach(color => {
    if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
      const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
      const row = {
        ì œí’ˆì„ íƒ: mode === "both" ? `${ìƒí’ˆëª…} / ${color}` : ìƒí’ˆëª…,
        ì˜µì…˜ê°€: 0,
        ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
        ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
        ì‚¬ìš©ì—¬ë¶€: "Y"
      };
      if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
      if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = ëŒ€í‘œ.ì‚¬ì´ì¦ˆ;
      data.push(row);
    } else {
      ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color) || í’ˆì ˆì¡°í•©.includes(size) || í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
        const row = {
          ì œí’ˆì„ íƒ: mode === "both" ? `${ìƒí’ˆëª…} / ${color}` : ìƒí’ˆëª…,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        };
        if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
        if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = size;
        data.push(row);
      });
    }
  });

  const header = ["ì œí’ˆì„ íƒ"];
  if (mode === "colorOnly") header.push("ìƒ‰ìƒ");
  if (mode === "sizeOnly" || mode === "both") header.push("ì‚¬ì´ì¦ˆ");
  header.push("ì˜µì…˜ê°€", "ì¬ê³ ìˆ˜ëŸ‰", "ê´€ë¦¬ì½”ë“œ", "ì‚¬ìš©ì—¬ë¶€");

  const rowsArray = data.map(row => {
    const line = [row.ì œí’ˆì„ íƒ];
    if (mode === "colorOnly") line.push(row.ìƒ‰ìƒ);
    if (mode === "sizeOnly" || mode === "both") line.push(row.ì‚¬ì´ì¦ˆ);
    line.push(row.ì˜µì…˜ê°€, row.ì¬ê³ ìˆ˜ëŸ‰, row.ê´€ë¦¬ì½”ë“œ, row.ì‚¬ìš©ì—¬ë¶€);
    return line;
  });

  const ws = XLSX.utils.aoa_to_sheet([header, ...rowsArray]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
  const safeFileName = (ëŒ€í‘œ.ìƒí’ˆëª… || "ë‹¨í’ˆë“±ë¡").replace(/[\/:*?"<>|]/g, "").trim();
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ë‹¨í’ˆë“±ë¡_${safeFileName}.xls`);
}

// ë‹¨í’ˆë“±ë¡ìš© ì „ì²´ ì—‘ì…€ ZIP ë‹¤ìš´ë¡œë“œ
function downloadSingleProductExcelAll() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const mode = getOptionDisplayMode();
  const zip = new JSZip();
  const ìƒí’ˆê·¸ë£¹ = [...new Set(rows.map(r => r.ìƒí’ˆëª…))];

  ìƒí’ˆê·¸ë£¹.forEach(ìƒí’ˆëª… => {
    const ê·¸ë£¹ = rows.filter(r => r.ìƒí’ˆëª… === ìƒí’ˆëª…);
    const ëŒ€í‘œ = ê·¸ë£¹.find(r => r.ëŒ€í‘œ) || ê·¸ë£¹[0];
    const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
    const í’ˆì ˆì¡°í•© = parseOptions(ëŒ€í‘œ.í’ˆì ˆëœì¡°í•©);
    const ëŒ€í‘œìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;

    const data = [];
    const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length > 0 ? ìƒ‰ìƒëª©ë¡ : [""];

    ìƒ‰ìƒë°°ì—´.forEach(color => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
        const row = {
          ì œí’ˆì„ íƒ: mode === "both" ? `${ëŒ€í‘œìƒí’ˆëª…} / ${color}` : ëŒ€í‘œìƒí’ˆëª…,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        };
        if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
        if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = ëŒ€í‘œ.ì‚¬ì´ì¦ˆ;
        data.push(row);
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color) || í’ˆì ˆì¡°í•©.includes(size) || í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
          const row = {
            ì œí’ˆì„ íƒ: mode === "both" ? `${ëŒ€í‘œìƒí’ˆëª…} / ${color}` : ëŒ€í‘œìƒí’ˆëª…,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          };
          if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
          if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = size;
          data.push(row);
        });
      }
    });

    const header = ["ì œí’ˆì„ íƒ"];
    if (mode === "colorOnly") header.push("ìƒ‰ìƒ");
    if (mode === "sizeOnly" || mode === "both") header.push("ì‚¬ì´ì¦ˆ");
    header.push("ì˜µì…˜ê°€", "ì¬ê³ ìˆ˜ëŸ‰", "ê´€ë¦¬ì½”ë“œ", "ì‚¬ìš©ì—¬ë¶€");

    const rowsArray = data.map(row => {
      const line = [row.ì œí’ˆì„ íƒ];
      if (mode === "colorOnly") line.push(row.ìƒ‰ìƒ);
      if (mode === "sizeOnly" || mode === "both") line.push(row.ì‚¬ì´ì¦ˆ);
      line.push(row.ì˜µì…˜ê°€, row.ì¬ê³ ìˆ˜ëŸ‰, row.ê´€ë¦¬ì½”ë“œ, row.ì‚¬ìš©ì—¬ë¶€);
      return line;
    });

    const ws = XLSX.utils.aoa_to_sheet([header, ...rowsArray]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
    const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
    const safeFileName = (ëŒ€í‘œ.ìƒí’ˆëª… || "ë‹¨í’ˆë“±ë¡").replace(/[\/:*?"<>|]/g, "").trim();
    zip.file(`ë‹¨í’ˆë“±ë¡_${safeFileName}.xls`, wbout);
  });

  zip.generateAsync({ type: "blob" }).then(content => {
    saveAs(content, "ë‹¨í’ˆë“±ë¡_ì „ì²´ë‹¤ìš´ë¡œë“œ.zip");
  });
}

// ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë¶„ë¦¬ í•¨ìˆ˜
function parseOptions(input) {
  if (!input || typeof input !== 'string') return [];
  return input.split(/[,/]/).map(s => s.trim()).filter(Boolean);
}
// ì˜µì…˜ ë…¸ì¶œ ë°©ì‹ í™•ì¸ í•¨ìˆ˜
function getOptionDisplayMode() {
  const selected = document.querySelector('input[name="optionDisplay"]:checked');
  return selected ? selected.value : "both";
} 
// ì˜µì…˜ êµ¬ì„± ë°©ì‹ ì ìš© í•¨ìˆ˜
  function applyOptionMode(ì œí’ˆëª…, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìƒí’ˆëª…, ìˆœë²ˆ) {
    // ìˆœë²ˆì´ ìˆì„ ë•Œë§Œ "NN) " í˜•íƒœë¥¼ ë¶™ì´ê³ , ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì œí’ˆëª…ë§Œ
    const prefix = ìˆœë²ˆ ? `${ìˆœë²ˆ}) ` : "";
    let í…ìŠ¤íŠ¸ = `${prefix}${ì œí’ˆëª…}`;
  if (!ìƒ‰ìƒ && !ì‚¬ì´ì¦ˆ) {
    return { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸ };
  }
  if (getOptionDisplayMode() === "colorOnly") {
    return { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸, ìƒ‰ìƒ };
  }
  if (getOptionDisplayMode() === "sizeOnly") {
    return ì‚¬ì´ì¦ˆ
      ? { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸, ì‚¬ì´ì¦ˆ }
      : { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸ };
  }
  // both
  // ìƒ‰ìƒ&ì‚¬ì´ì¦ˆ ëª¨ë‘
  if (ìƒ‰ìƒ) í…ìŠ¤íŠ¸ += ` / ${ìƒ‰ìƒ}`;
  if (ì‚¬ì´ì¦ˆ) {
    return { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ };
  } else {
    return { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸, ìƒ‰ìƒ };
  }
}
// 1) expandSizes ì •ì˜ (ì´ í•¨ìˆ˜ê°€ ëë‚˜ë©´ ë°”ë¡œ ë°”ë¡œ ë°‘ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ)
function expandSizes(sizeStr) {
  if (!sizeStr || typeof sizeStr !== 'string') return [];

  // ì‰¼í‘œ ë˜ëŠ” ìŠ¬ë˜ì‹œ êµ¬ë¶„
  if (sizeStr.includes(',') || sizeStr.includes('/')) {
    return sizeStr.split(/[,/]/).map(s => s.trim()).filter(Boolean);
  }

  // ë²”ìœ„ (ì˜ˆ: "230~240")
  const rangeMatch = sizeStr.match(/^(\d{3})~(\d{3})$/);
  if (rangeMatch) {
    const start = parseInt(rangeMatch[1], 10);
    const end   = parseInt(rangeMatch[2], 10);
    const result = [];
    for (let i = start; i <= end; i += 5) {
      result.push(i.toString());
    }
    return result;
  }

  // ë‹¨ì¼ê°’
  return [sizeStr.trim()];
}  // <-- ì—¬ê¸° ë‹«ëŠ” ì¤‘ê´„í˜¸ ë°˜ë“œì‹œ!

// 2) íŒŒì¼ ì—…ë¡œë“œ ë¦¬ìŠ¤ë„ˆ
document.getElementById("inputFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(evt) {
    // 1) ì›Œí¬ë¶ íŒŒì‹±
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheetName = workbook.SheetNames.find(name =>
      name.includes("ìƒí’ˆ") || name.includes("ì˜µì…˜")
    ) || workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    if (!sheet) return alert("ìƒí’ˆì˜µì…˜ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

    // 2) JSON ë³€í™˜ â†’ í…Œì´ë¸” ì´ˆê¸°í™” â†’ addRow ë°˜ë³µ
    const json = XLSX.utils.sheet_to_json(sheet, { defval: "" });
    clearTable();
    json.forEach(row => addRow({
      ìƒí’ˆëª…: row["ìƒí’ˆëª…"],
      íŒë§¤ê°€: row["íŒë§¤ê°€"],
      ìƒ‰ìƒ: row["ìƒ‰ìƒ"],
      ì‚¬ì´ì¦ˆ: row["ì‚¬ì´ì¦ˆ"],
      ["1ë²ˆ ìƒí’ˆëª…"]: row["1ë²ˆ ìƒí’ˆëª…"],
      í’ˆì ˆëœì¡°í•©: row["í’ˆì ˆëœ ì¡°í•©"] || '',
      ì œì™¸: row["ì œì™¸"] === 'Y' || row["ì œì™¸"] === true
    }));

    // 3) í…Œì´ë¸”ì´ ì±„ì›Œì§„ ë’¤ì— originalDataì— ì €ì¥
    originalData = getDataFromTable();
  };

  reader.readAsArrayBuffer(file);
});
  //ì„ íƒëœ ì²´í¬ë°•ìŠ¤ ë‚´ìš©ì„ ìœ„ì•„ë˜ë¡œ ì „í™˜
    function moveSelectedUp() {
  const tbody = document.querySelector("#inputTable tbody");
  // ëª¨ë“  í–‰ì„ ë°°ì—´ë¡œ, ìœ„ìª½ë¶€í„° ìˆœíšŒí•˜ë©°
  Array.from(tbody.querySelectorAll("tr")).forEach(row => {
    const cb = row.querySelector(".to-move");
    if (!cb || !cb.checked) return;
    const prev = row.previousElementSibling;
    if (prev) tbody.insertBefore(row, prev);
  });
}

function moveSelectedDown() {
  const tbody = document.querySelector("#inputTable tbody");
  // ì•„ë˜ì—ì„œë¶€í„° ìˆœíšŒí•´ì•¼ ìˆœì„œ ê¼¬ì´ì§€ ì•ŠìŒ
  Array.from(tbody.querySelectorAll("tr")).reverse().forEach(row => {
    const cb = row.querySelector(".to-move");
    if (!cb || !cb.checked) return;
    const next = row.nextElementSibling;
    if (next) tbody.insertBefore(next, row);
  });
}


  </script>
</body>
</html>
