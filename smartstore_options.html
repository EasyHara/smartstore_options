  <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/plugins/SortableMultiDrag.min.js"></script>

  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /* ë°•ìŠ¤ ëª¨ë¸ í†µì¼ */
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      background: #f5f6fa;
      color: #333;
    }

    .container {
      max-width: 100%;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      overflow-x: auto;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 16px;
    }

    .guide {
      position: relative;
      background: #f8f9fc;
      padding: 16px 20px;
      margin-bottom: 24px;
      border-radius: 10px;
      line-height: 1.6;
      box-shadow: 0 0 0 1px #e5e7eb;
    }
    .guide a.github {
      position: absolute;
      top: 12px; right: 16px;
      background: #f8f9fc; color: #2563eb;
      font-weight: 500; font-size: 14px;
      text-decoration: none;
      padding: 4px 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
    }
    .guide strong { display: block; margin-bottom: 8px; }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    table {
      width: 100%; min-width: 1200px;
      border-collapse: collapse;
      margin: 10px 0;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      word-break: break-word;
      vertical-align: middle;
    }
    th { background: #f0f0f0; }

    /* ê³µí†µ ë²„íŠ¼/ì…ë ¥ ìŠ¤íƒ€ì¼ */
    button, input[type="file"], input[type="number"], input[type="text"] {
      margin: 4px; padding: 6px 10px;
      font-size: 14px; height: 36px;
      vertical-align: middle;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    /* ëª¨ë“  í…Œì´ë¸” ë‚´ë¶€ í…ìŠ¤íŠ¸/ë„˜ë²„ ì…ë ¥ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    #inputTable td input[type="text"],
    #inputTable td input[type="number"] {
      width: 100%;
      box-sizing: border-box;
      border: none;
      outline: none;
      background: transparent;
      padding: 4px 6px;
      margin: 0;
    }

    /* ì´ë™ ì²´í¬ë°•ìŠ¤(.to-move) ì»¤ìŠ¤í…€ */
    #inputTable td input.to-move {
      -webkit-appearance: none;
      appearance: none;
      width: 16px; height: 16px;
      background-color: transparent; border: none;
      cursor: pointer; margin: auto; display: block;
      position: relative;
    }
    #inputTable td input.to-move:checked {
      background-color: #2563eb;
    }
    #inputTable td input.to-move:checked::after {
      content: 'âœ”';
      color: #fff;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px; line-height: 1;
    }

    /* ë¼ë””ì˜¤ ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
    #inputTable td input[type="radio"] {
      margin: auto; display: block;
    }

    /* 8ë²ˆì§¸ ì—´(í’ˆì ˆëœ ì¡°í•©) ë§ì¤„ì„ */
    #inputTable td:nth-child(8) input[type="text"] {
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ƒ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</h1>

    <!-- íŒŒì¼ ì—…ë¡œë“œ & í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ -->
    <input type="file" id="inputFile" accept=".xls,.xlsx">
    <button onclick="downloadTemplate()">ì—‘ì…€ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>

    <!-- ì‚¬ì´ì¦ˆ ì…ë ¥ ë°©ë²• ì•ˆë‚´ + GitHub ë§í¬ -->
    <div class="guide">
      <a href="https://github.com/EasyHara/smartstore_options/blob/main/smartstore_options.html"
         class="github" target="_blank">ì›¹ íŒŒì¼</a>
      <strong>ì‚¬ì´ì¦ˆ ì…ë ¥ ë°©ë²• ì•ˆë‚´</strong>
      <ul style="margin:0; padding-left:20px;">
        <li><strong>ë²”ìœ„ ì…ë ¥:</strong> <code>230~240</code> â†’ 5ë‹¨ìœ„ ìë™ ìƒì„± (ì˜ˆ: 230,235,240)</li>
        <li><strong>ê°œë³„ ì…ë ¥:</strong> <code>230,235/245</code> â†’ ì‰¼í‘œ ë˜ëŠ” ìŠ¬ë˜ì‹œë¡œ ì§ì ‘ ì§€ì •</li>
        <li>ë„¤ì´ë²„ ê·œì •ì— ë”°ë¼ ë¯¸ë‹¬Â·ì´ˆê³¼ ì˜µì…˜ì€ ë‹¤ìš´ë¡œë“œ ì‹œ ìë™ ì œê±°ë©ë‹ˆë‹¤</li>
      </ul>
    </div>

    <!-- ì˜µì…˜ ë…¸ì¶œ ë°©ì‹ / í• ì¸ë¥  -->
    <div style="margin-bottom:24px;">
      <span>ì˜µì…˜ ë…¸ì¶œ ë°©ì‹:</span>
      <label><input type="radio" name="optionDisplay" value="both" checked> ìƒ‰ìƒ&ì‚¬ì´ì¦ˆ ëª¨ë‘</label>
      <label><input type="radio" name="optionDisplay" value="colorOnly"> ìƒ‰ìƒë§Œ</label>
      <label><input type="radio" name="optionDisplay" value="sizeOnly"> ì‚¬ì´ì¦ˆë§Œ</label>
      <label style="margin-left:20px;">ì˜µì…˜ê°€ ê³„ì‚° í• ì¸ë¥  (%)</label>
      <input type="number" id="discountRate" value="0" min="0" max="99">%
    </div>

    <!-- ì˜µì…˜ í…Œì´ë¸” -->
    <table id="inputTable">
      <thead>
        <tr>
          <th>ì´ë™</th>
          <th>ëŒ€í‘œ</th>
          <th>ìƒí’ˆëª…</th>
          <th>íŒë§¤ê°€(ë„¤ì´ë²„í• ì¸ê°€)</th>
          <th>ìƒ‰ìƒ</th>
          <th>ì‚¬ì´ì¦ˆ</th>
          <th>1ë²ˆ ìƒí’ˆëª…</th>
          <th>í’ˆì ˆëœ ì¡°í•©</th>
          <th>ì œì™¸</th>
        </tr>
      </thead>
      <tbody>
        <!-- JSë¡œ addRow() í˜¸ì¶œ ì‹œ ì—¬ê¸°ì— <tr>ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </tbody>
    </table>

    <!-- í–‰ ì¶”ê°€ / ì¡°ì‘ ë²„íŠ¼ -->
    <button onclick="addRow()">+ í–‰ ì¶”ê°€</button>
    <button onclick="clearTable()">ì´ˆê¸°í™”</button>
    <button onclick="resetOrder()">ìˆœì„œ ì´ˆê¸°í™”</button>
    <button onclick="moveSelectedToTop()">ë§¨ ìœ„ë¡œ</button>
    <button onclick="moveSelectedUp()">ìœ„ë¡œ</button>
    <button onclick="moveSelectedDown()">ì•„ë˜ë¡œ</button>
    <button onclick="moveSelectedToBottom()">ë§¨ ì•„ë˜ë¡œ</button>

    <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <div style="text-align:center; margin-top:20px;">
      <button onclick="downloadRepresentative()">ì„ íƒìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="generateZip()">ì¼ê´„ ZIP ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadAddProductExcel()">ì¶”ê°€ìƒí’ˆ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadSingleProductExcel()">ë‹¨í’ˆë“±ë¡ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="downloadSingleProductExcelAll()">ë‹¨í’ˆ ì „ì²´ ZIP</button>
      <button onclick="downloadOrderedTemplate()">ìˆœì„œë°˜ì˜ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </div>

  <script>


    // í´ë¦­ í•¸ë“¤ëŸ¬: Ctrl/Cmd+í´ë¦­ ì‹œ selected í´ë˜ìŠ¤ í† ê¸€
function onRowClick(e) {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
  if (e.ctrlKey || e.metaKey) this.classList.toggle('selected');
}

      // í–‰ ì¶”ê°€ + í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
function addRow(data = {}) {
  const tbody = document.querySelector('#inputTable tbody');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><input type="checkbox" class="to-move"></td>
    <td><input type="radio" name="ëŒ€í‘œ"></td>
    <td><input type="text" value="${data.ìƒí’ˆëª…||''}"></td>
    <td><input type="number" value="${data.íŒë§¤ê°€||''}"></td>
    <td><input type="text" value="${data.ìƒ‰ìƒ||''}"></td>
    <td><input type="text" value="${data.ì‚¬ì´ì¦ˆ||''}"></td>
    <td><input type="text" value="${data['1ë²ˆ ìƒí’ˆëª…']||''}"></td>
    <td><input type="text" value="${data.í’ˆì ˆëœì¡°í•©||''}"></td>
    <td><input type="checkbox" ${data.ì œì™¸?'checked':''}></td>
  `;
  row.addEventListener('click', onRowClick);
  tbody.appendChild(row);
}
  // core + plugin ëª¨ë‘ ë¡œë“œëœ ì´í›„ì— í•œ ë²ˆë§Œ ì‹¤í–‰
  Sortable.create(document.querySelector('#inputTable tbody'), {
    animation: 150,
    handle: 'td',
    multiDrag: true,           // ë©€í‹° ë“œë˜ê·¸ í™œì„±í™”
    selectedClass: 'selected', // ì„ íƒëœ í–‰ì— ì ìš©í•  í´ë˜ìŠ¤
    multiDragKey: 'ctrl',      // Ctrl(Cmd) í‚¤ë¡œ ë³µìˆ˜ ì„ íƒ
    fallbackTolerance: 3
  });
    
// í…Œì´ë¸” ë°ì´í„°ë¥¼ ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹ ì–‘ì‹ìœ¼ë¡œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
function downloadOrderedTemplate() {
  // 1) í—¤ë” ì •ì˜ (ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹ê³¼ ë™ì¼)
  const headers = [
    "ìƒí’ˆëª…",
    "íŒë§¤ê°€",
    "ìƒ‰ìƒ",
    "ì‚¬ì´ì¦ˆ",
    "1ë²ˆ ìƒí’ˆëª…",
    "í’ˆì ˆëœ ì¡°í•©",
    "ì œì™¸"
  ];

  // 2) í˜„ì¬ í™”ë©´ì— í‘œì‹œëœ ìˆœì„œëŒ€ë¡œ <tbody>ì˜ ê° <tr>ì„ ì½ì–´ì„œ ë°ì´í„° ë°°ì—´ ìƒì„±
  const data = Array.from(document.querySelectorAll('#inputTable tbody tr')).map(row => {
    const inputs = row.querySelectorAll('input');
    return [
      inputs[2].value.trim(),                // ìƒí’ˆëª…
      parseInt(inputs[3].value, 10) || 0,    // íŒë§¤ê°€
      inputs[4].value.trim(),                // ìƒ‰ìƒ
      inputs[5].value.trim(),                // ì‚¬ì´ì¦ˆ
      inputs[6].value.trim(),                // 1ë²ˆ ìƒí’ˆëª…
      inputs[7].value.trim(),                // í’ˆì ˆëœ ì¡°í•©
      inputs[8].checked ? 'Y' : ''           // ì œì™¸(Y/ë¹ˆë¬¸ì)
    ];
  });

  // 3) SheetJSë¡œ ì›Œí¬ì‹œíŠ¸, ì›Œí¬ë¶ ìƒì„±
  const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ìƒí’ˆì˜µì…˜");

  // 4) Blobìœ¼ë¡œ ë³€í™˜ í›„ FileSaver.jsë¡œ ë‹¤ìš´ë¡œë“œ
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  const blob = new Blob([wbout], { type: 'application/octet-stream' });
  saveAs(blob, 'ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹-ìˆœì„œë°˜ì˜.xls');
  }

    
    let originalData = [];

    // í…Œì´ë¸” ì´ˆê¸°í™”
function clearTable() {
  document.querySelector('#inputTable tbody').innerHTML = '';
  document.getElementById('inputFile').value = '';    // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
  originalData = [];                                  // ì €ì¥ëœ ì›ë³¸ ìˆœì„œë„ ì´ˆê¸°í™”
}

    // ì›ë˜ ìˆœì„œ ë³µì›
function resetOrder() {
  const tbody = document.querySelector('#inputTable tbody');
  tbody.innerHTML = '';
  originalData.forEach(d => addRow(d));
}

    // í˜„ì¬ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì½ì–´ì„œ ê°ì²´ ë°°ì—´ ë¦¬í„´
    function getDataFromTable() {
      return Array.from(document.querySelectorAll('#inputTable tbody tr')).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
          ëŒ€í‘œ:     inputs[1].checked,
          ìƒí’ˆëª…:   inputs[2].value.trim(),
          íŒë§¤ê°€:   parseInt(inputs[3].value)||0,
          ìƒ‰ìƒ:     inputs[4].value.trim(),
          ì‚¬ì´ì¦ˆ:   inputs[5].value.trim(),
          ['1ë²ˆ ìƒí’ˆëª…']: inputs[6].value.trim(),
          í’ˆì ˆëœì¡°í•©: inputs[7].value.trim(),
          ì œì™¸:     inputs[8].checked
        };
      });
    }

    // ì„ íƒëœ í–‰ì„ ìœ„ë¡œ/ì•„ë˜ë¡œ ì´ë™
    function moveSelectedUp() {
  const tbody = document.querySelector('#inputTable tbody');
  // ëª¨ë“  í–‰ì„ ë°°ì—´ë¡œ, ìœ„ìª½ë¶€í„° ìˆœíšŒí•˜ë©°
  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    const cb = row.querySelector('.to-move');
    if (!cb || !cb.checked) return;
    const prev = row.previousElementSibling;
    if (prev) tbody.insertBefore(row, prev);
  });
}
    function moveSelectedDown() {
      const tbody = document.querySelector('#inputTable tbody');
      Array.from(tbody.querySelectorAll('tr')).reverse().forEach(row => {
        const cb = row.querySelector('.to-move');
        if (cb && cb.checked) {
          const next = row.nextElementSibling;
          if (next) tbody.insertBefore(next, row);
        }
      });
    }
    // ì„ íƒëœ í–‰ì„ ë§¨ ìœ„ë¡œ ì´ë™
function moveSelectedToTop() {
  const tbody = document.querySelector('#inputTable tbody');
  // ì²´í¬ëœ í–‰ë“¤ì„ ìœ„â†’ì•„ë˜ ìˆœì„œë¡œ ì°¾ì•„ì„œ
  Array.from(tbody.querySelectorAll('tr')).forEach(row => {
    const cb = row.querySelector('.to-move');
    if (cb && cb.checked) {
      // ë§¨ ìœ„(ì²« ë²ˆì§¸ ìì‹) ì•ì— ì‚½ì…
      tbody.insertBefore(row, tbody.firstElementChild);
    }
  });
}
    // ì„ íƒëœ í–‰ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™
function moveSelectedToBottom() {
  const tbody = document.querySelector('#inputTable tbody');
  // ì²´í¬ëœ í–‰ë“¤ì„ ì•„ë˜â†’ìœ„ ìˆœì„œë¡œ ì°¾ì•„ì„œ
  Array.from(tbody.querySelectorAll('tr')).reverse().forEach(row => {
    const cb = row.querySelector('.to-move');
    if (cb && cb.checked) {
      tbody.appendChild(row);
    }
  });
}

    // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
    function downloadTemplate() {
      const headers = ['ìƒí’ˆëª…','íŒë§¤ê°€','ìƒ‰ìƒ','ì‚¬ì´ì¦ˆ','1ë²ˆ ìƒí’ˆëª…','í’ˆì ˆëœ ì¡°í•©','ì œì™¸'];
      const ws = XLSX.utils.aoa_to_sheet([headers]);
      const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'ìƒí’ˆì˜µì…˜');
      const blob = new Blob([XLSX.write(wb,{bookType:'xls',type:'array'})],{type:'application/octet-stream'});
      saveAs(blob,'ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹.xls');
    }

    // ì—…ë¡œë“œ íŒŒì¼ ì½ê¸° & ì›ë³¸ ì €ì¥
   document.getElementById('inputFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => {
        const data = new Uint8Array(evt.target.result);
        const wb = XLSX.read(data,{type:'array'});
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet,{defval:''});
        clearTable();
        json.forEach(r => addRow({
          ìƒí’ˆëª…: r['ìƒí’ˆëª…'],
          íŒë§¤ê°€: r['íŒë§¤ê°€'],
          ìƒ‰ìƒ:   r['ìƒ‰ìƒ'],
          ì‚¬ì´ì¦ˆ: r['ì‚¬ì´ì¦ˆ'],
          '1ë²ˆ ìƒí’ˆëª…': r['1ë²ˆ ìƒí’ˆëª…'],
          í’ˆì ˆëœì¡°í•©: r['í’ˆì ˆëœ ì¡°í•©']||'',
          ì œì™¸: r['ì œì™¸']==='Y'
        }));
        originalData = getDataFromTable();
      };
      reader.readAsArrayBuffer(file);
    });
      // ë„¤ì´ë²„ ì˜µì…˜ê°€ ìœ íš¨ì„± ê²€ì‚¬
  function isValidOptionPrice(basePrice, diff) {
    if (basePrice < 2000) return diff >= 0 && diff <= basePrice;
    if (basePrice < 10000) return diff >= -basePrice * 0.5 && diff <= basePrice;
    return diff >= -basePrice * 0.5 && diff <= basePrice * 0.5;
  }

  // í• ì¸ë¥  ê¸°ì¤€ ì›ê°€ ê³„ì‚°
  function calculateOriginalPrice(salePrice, discountRate) {
    const raw = salePrice / (1 - discountRate / 100);
    return Math.round(raw / 100) * 100;
  }

  // ì˜µì…˜ ë¬¸ìì—´ â†’ ë°°ì—´
  function parseOptions(str) {
    if (!str) return [];
    return str.toString().split(/[,/]/).map(s => s.trim()).filter(Boolean);
  }

   
// ëŒ€í‘œìƒí’ˆ ê¸°ì¤€ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
function downloadRepresentative() {
  // 1) ì œì™¸ëœ í–‰ ê±°ë¥´ê³  ëŒ€í‘œ ì°¾ê¸°
  let rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) {
    alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];

  // 2) ëŒ€í‘œë§Œ ë‚¨ê²¨ì„œ ì˜µì…˜ ìƒì„±
  rows = [ëŒ€í‘œ];

  // 3) í• ì¸ë¥  & ëŒ€í‘œì •ê°€
  const í• ì¸ë¥  = parseFloat(document.getElementById("discountRate").value) || 0;
  const ëŒ€í‘œì •ê°€ = calculateOriginalPrice(ëŒ€í‘œ.íŒë§¤ê°€, í• ì¸ë¥ );
  const mode = getOptionDisplayMode();

  // 4) ì˜µì…˜ ì¡°í•© ìƒì„±
  let data = [];
  rows.forEach(item => {
    const ì˜µì…˜ê°€ = item.íŒë§¤ê°€ - ëŒ€í‘œ.íŒë§¤ê°€;
    if (!isValidOptionPrice(ëŒ€í‘œì •ê°€, ì˜µì…˜ê°€)) return;

    const nm = item.ìƒí’ˆëª…;
    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ).length ? parseOptions(item.ìƒ‰ìƒ) : [""];
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);

    ìƒ‰ìƒëª©ë¡.forEach(col => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        data.push({
          ...applyOptionMode(nm, col, null, ""),
          ì˜µì…˜ê°€, ì¬ê³ ìˆ˜ëŸ‰: 99999, ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(sz => {
          data.push({
            ...applyOptionMode(nm, col, sz, ""),
            ì˜µì…˜ê°€, ì¬ê³ ìˆ˜ëŸ‰: 99999, ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        });
      }
    });
  });

  // 5) ì¤‘ë³µ ì œê±°
  {
    const seen = new Set();
    data = data.filter(r => {
      const key = [r.ê´€ë¦¬ì½”ë“œ, r.ì˜µì…˜ê°€, r.ìƒ‰ìƒ||"", r.ì‚¬ì´ì¦ˆ||""].join("|");
      if (seen.has(key)) return false;
      seen.add(key);
      return true;
    });
  }

  // 6) ìˆœë²ˆ ë§¤í•‘ & applyOptionModeì—ì„œ ë¶™ì¸ í…ìŠ¤íŠ¸ ì•ì— ë²ˆí˜¸ ë¶™ì´ê¸°
  const seqMap = {};
  data.forEach(r => {
    if (!(r.ê´€ë¦¬ì½”ë“œ in seqMap)) seqMap[r.ê´€ë¦¬ì½”ë“œ] = Object.keys(seqMap).length + 1;
  });
  data = data.map(r => {
    const seq = String(seqMap[r.ê´€ë¦¬ì½”ë“œ]).padStart(2, "0");
    return { ...r, ì œí’ˆì„ íƒ: `${seq}) ${r.ì œí’ˆì„ íƒ}` };
  });

  // 7) ì»¬ëŸ¼ ì •ë¦¬
  if (mode === "both")      data.forEach(r => delete r.ìƒ‰ìƒ);
  if (mode === "colorOnly") data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);
  if (mode === "sizeOnly")  data.forEach(r => delete r.ìƒ‰ìƒ);

  // 8) ì‹œíŠ¸ ìƒì„± í›„ ë‹¤ìš´ë¡œë“œ
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");
  saveAs(
    new Blob([XLSX.write(wb, { bookType: "xls", type: "array" })]),
    `${ëŒ€í‘œ.ìƒí’ˆëª…}.xls`
  );
}


// ì¼ê´„ ZIP ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
function generateZip() {
  // 1) ì œì™¸ëœ í–‰ í•„í„°ë§
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) {
    alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const discountRate = parseFloat(document.getElementById("discountRate").value) || 0;
  const mode = getOptionDisplayMode();
  const zip = new JSZip();

  // 2) ê° í–‰ì„ ëŒ€í‘œë¡œ ì²˜ë¦¬í•˜ì—¬ ZIPì— ì¶”ê°€
  rows.forEach(repr => {
    const originalPrice = calculateOriginalPrice(repr.íŒë§¤ê°€, discountRate);
    const ordered = [repr, ...rows.filter(r => r !== repr)];

    // ì˜µì…˜ ì¡°í•© ìƒì„±
    let data = [];
    ordered.forEach(item => {
      const diff = item.íŒë§¤ê°€ - repr.íŒë§¤ê°€;
      if (!isValidOptionPrice(originalPrice, diff)) return;

      const nm = item.ìƒí’ˆëª…;
      const cols = parseOptions(item.ìƒ‰ìƒ).length ? parseOptions(item.ìƒ‰ìƒ) : [""];
      const szs = expandSizes(item.ì‚¬ì´ì¦ˆ);

      cols.forEach(col => {
        if (szs.length === 0) {
          data.push({ ...applyOptionMode(nm, col, null, ""), ì˜µì…˜ê°€: diff, ì¬ê³ ìˆ˜ëŸ‰: 99999, ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€: "Y" });
        } else {
          szs.forEach(sz => {
            data.push({ ...applyOptionMode(nm, col, sz, ""), ì˜µì…˜ê°€: diff, ì¬ê³ ìˆ˜ëŸ‰: 99999, ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…, ì‚¬ìš©ì—¬ë¶€: "Y" });
          });
        }
      });
    });

    // ì¤‘ë³µ ì œê±°
    {
      const seen = new Set();
      data = data.filter(r => {
        const key = [r.ê´€ë¦¬ì½”ë“œ, r.ì˜µì…˜ê°€, r.ìƒ‰ìƒ||"", r.ì‚¬ì´ì¦ˆ||""].join("|");
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });
    }

    // ìˆœë²ˆ ë§¤í•‘ + 25ì íŠ¸ë¦¬ë°
    const seqMap = {};
    data.forEach(r => { if (!seqMap[r.ê´€ë¦¬ì½”ë“œ]) seqMap[r.ê´€ë¦¬ì½”ë“œ] = Object.keys(seqMap).length + 1; });
    data = data.map(r => {
      const seq = String(seqMap[r.ê´€ë¦¬ì½”ë“œ]).padStart(2, "0");
      let txt = `${seq}) ${r.ì œí’ˆì„ íƒ}`;
      txt = txt.replace(/\)\s*/g, ")").replace(/\s*\/\s*/g, "/");
      if (txt.length > 25) txt = txt.slice(0, 25);
      return { ...r, ì œí’ˆì„ íƒ: txt };
    });

    // ì»¬ëŸ¼ ì •ë¦¬
    if (mode === "both")      data.forEach(r => delete r.ìƒ‰ìƒ);
    if (mode === "colorOnly") data.forEach(r => delete r.ì‚¬ì´ì¦ˆ);
    if (mode === "sizeOnly")  data.forEach(r => delete r.ìƒ‰ìƒ);

    // ì›Œí¬ë¶ ìƒì„± & ZIPì— ì¶”ê°€
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");
    const blob = XLSX.write(wb, { bookType: "xls", type: "array" });
    zip.file(`${repr.ìƒí’ˆëª…}.xls`, blob);
  });

  // 3) ZIP ìƒì„± & ë‹¤ìš´ë¡œë“œ
  zip.generateAsync({ type: "blob" })
     .then(content => saveAs(content, "ì˜µì…˜_ì¼ê´„ë‹¤ìš´ë¡œë“œ.zip"));
}

// ì¶”ê°€ìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ëª¨ë“  ì œì™¸ë˜ì§€ ì•Šì€ ìƒí’ˆ í¬í•¨)
function downloadAddProductExcel() {
  const mode = getOptionDisplayMode();   // ì˜µì…˜ ë…¸ì¶œ ëª¨ë“œ í™•ì¸
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) {
    return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  }

  // ëŒ€í‘œ ìƒí’ˆ ê²°ì • & ìˆœì„œ ì •ë ¬
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  const items = rows.sort((a, b) => (a === ëŒ€í‘œ ? -1 : b === ëŒ€í‘œ ? 1 : 0));

  let data = [];
  let index = 1;

  items.forEach(item => {
    const ìˆœë²ˆ = index < 10 ? `0${index}` : `${index}`;
    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);
    const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length ? ìƒ‰ìƒëª©ë¡ : [""];

    ìƒ‰ìƒë°°ì—´.forEach(color => {
      const sizeList = ì‚¬ì´ì¦ˆëª©ë¡.length ? ì‚¬ì´ì¦ˆëª©ë¡ : [null];
      sizeList.forEach(size => {
        // applyOptionModeë¡œ ëª¨ë“œì— ë§ì¶˜ 'ì œí’ˆì„ íƒ' í…ìŠ¤íŠ¸ ìƒì„±
        const opt = applyOptionMode(item.ìƒí’ˆëª…, color, size, ìˆœë²ˆ);
        data.push({
          ì¶”ê°€ìƒí’ˆëª…: "ì œí’ˆì„ íƒ",
          ì¶”ê°€ìƒí’ˆê°’: opt.ì œí’ˆì„ íƒ,
          ì¶”ê°€ìƒí’ˆê°€: item.íŒë§¤ê°€,
          ì¬ê³ ìˆ˜ëŸ‰: 99999,
          ì‚¬ìš©ì—¬ë¶€: "Y",
          ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…
        });
      });
    });

    index++;
  });

  // ì¤‘ë³µ ì œê±° (ì¶”ê°€ìƒí’ˆê°’ ê¸°ì¤€)
  {
    const seen = new Set();
    data = data.filter(row => {
      if (seen.has(row.ì¶”ê°€ìƒí’ˆê°’)) return false;
      seen.add(row.ì¶”ê°€ìƒí’ˆê°’);
      return true;
    });
  }

  // ì—‘ì…€ ì‹œíŠ¸ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì¶”ê°€ìƒí’ˆ");
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  const safeName = ëŒ€í‘œ.ìƒí’ˆëª….replace(/[\\/:*?"<>|]/g, "").trim();
  saveAs(
    new Blob([wbout], { type: 'application/octet-stream' }),
    `ì¶”ê°€ìƒí’ˆ_${safeName}.xls`
  );
}

// ë‹¨í’ˆë“±ë¡ìš© ì—‘ì…€ ë‹¤ìš´ë¡œë“œ - ëŒ€í‘œìƒí’ˆë§Œ ìˆœë²ˆ ì—†ì´ ì¶œë ¥  
function downloadSingleProductExcel() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  if (!ëŒ€í‘œ) return alert("ëŒ€í‘œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");

  const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
  const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
  const í’ˆì ˆì¡°í•© = parseOptions(ëŒ€í‘œ.í’ˆì ˆëœì¡°í•©);
  const ìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;
  const mode = getOptionDisplayMode();

  const data = [];

  ìƒ‰ìƒëª©ë¡.forEach(color => {
    if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
      const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
      const row = {
        ì œí’ˆì„ íƒ: mode === "both" ? `${ìƒí’ˆëª…} / ${color}` : ìƒí’ˆëª…,
        ì˜µì…˜ê°€: 0,
        ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
        ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
        ì‚¬ìš©ì—¬ë¶€: "Y"
      };
      if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
      if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = ëŒ€í‘œ.ì‚¬ì´ì¦ˆ;
      data.push(row);
    } else {
      ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color) || í’ˆì ˆì¡°í•©.includes(size) || í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
        const row = {
          ì œí’ˆì„ íƒ: mode === "both" ? `${ìƒí’ˆëª…} / ${color}` : ìƒí’ˆëª…,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        };
        if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
        if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = size;
        data.push(row);
      });
    }
  });

  const header = ["ì œí’ˆì„ íƒ"];
  if (mode === "colorOnly") header.push("ìƒ‰ìƒ");
  if (mode === "sizeOnly" || mode === "both") header.push("ì‚¬ì´ì¦ˆ");
  header.push("ì˜µì…˜ê°€", "ì¬ê³ ìˆ˜ëŸ‰", "ê´€ë¦¬ì½”ë“œ", "ì‚¬ìš©ì—¬ë¶€");

  const rowsArray = data.map(row => {
    const line = [row.ì œí’ˆì„ íƒ];
    if (mode === "colorOnly") line.push(row.ìƒ‰ìƒ);
    if (mode === "sizeOnly" || mode === "both") line.push(row.ì‚¬ì´ì¦ˆ);
    line.push(row.ì˜µì…˜ê°€, row.ì¬ê³ ìˆ˜ëŸ‰, row.ê´€ë¦¬ì½”ë“œ, row.ì‚¬ìš©ì—¬ë¶€);
    return line;
  });

  const ws = XLSX.utils.aoa_to_sheet([header, ...rowsArray]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
  const safeFileName = (ëŒ€í‘œ.ìƒí’ˆëª… || "ë‹¨í’ˆë“±ë¡").replace(/[\/:*?"<>|]/g, "").trim();
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ë‹¨í’ˆë“±ë¡_${safeFileName}.xls`);
}

// ë‹¨í’ˆë“±ë¡ìš© ì „ì²´ ì—‘ì…€ ZIP ë‹¤ìš´ë¡œë“œ
function downloadSingleProductExcelAll() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const mode = getOptionDisplayMode();
  const zip = new JSZip();
  const ìƒí’ˆê·¸ë£¹ = [...new Set(rows.map(r => r.ìƒí’ˆëª…))];

  ìƒí’ˆê·¸ë£¹.forEach(ìƒí’ˆëª… => {
    const ê·¸ë£¹ = rows.filter(r => r.ìƒí’ˆëª… === ìƒí’ˆëª…);
    const ëŒ€í‘œ = ê·¸ë£¹.find(r => r.ëŒ€í‘œ) || ê·¸ë£¹[0];
    const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
    const í’ˆì ˆì¡°í•© = parseOptions(ëŒ€í‘œ.í’ˆì ˆëœì¡°í•©);
    const ëŒ€í‘œìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;

    const data = [];
    const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length > 0 ? ìƒ‰ìƒëª©ë¡ : [""];

    ìƒ‰ìƒë°°ì—´.forEach(color => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
        const row = {
          ì œí’ˆì„ íƒ: mode === "both" ? `${ëŒ€í‘œìƒí’ˆëª…} / ${color}` : ëŒ€í‘œìƒí’ˆëª…,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        };
        if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
        if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = ëŒ€í‘œ.ì‚¬ì´ì¦ˆ;
        data.push(row);
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color) || í’ˆì ˆì¡°í•©.includes(size) || í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
          const row = {
            ì œí’ˆì„ íƒ: mode === "both" ? `${ëŒ€í‘œìƒí’ˆëª…} / ${color}` : ëŒ€í‘œìƒí’ˆëª…,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          };
          if (mode === "colorOnly") row.ìƒ‰ìƒ = color;
          if (mode === "sizeOnly" || mode === "both") row.ì‚¬ì´ì¦ˆ = size;
          data.push(row);
        });
      }
    });

    const header = ["ì œí’ˆì„ íƒ"];
    if (mode === "colorOnly") header.push("ìƒ‰ìƒ");
    if (mode === "sizeOnly" || mode === "both") header.push("ì‚¬ì´ì¦ˆ");
    header.push("ì˜µì…˜ê°€", "ì¬ê³ ìˆ˜ëŸ‰", "ê´€ë¦¬ì½”ë“œ", "ì‚¬ìš©ì—¬ë¶€");

    const rowsArray = data.map(row => {
      const line = [row.ì œí’ˆì„ íƒ];
      if (mode === "colorOnly") line.push(row.ìƒ‰ìƒ);
      if (mode === "sizeOnly" || mode === "both") line.push(row.ì‚¬ì´ì¦ˆ);
      line.push(row.ì˜µì…˜ê°€, row.ì¬ê³ ìˆ˜ëŸ‰, row.ê´€ë¦¬ì½”ë“œ, row.ì‚¬ìš©ì—¬ë¶€);
      return line;
    });

    const ws = XLSX.utils.aoa_to_sheet([header, ...rowsArray]);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
    const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
    const safeFileName = (ëŒ€í‘œ.ìƒí’ˆëª… || "ë‹¨í’ˆë“±ë¡").replace(/[\/:*?"<>|]/g, "").trim();
    zip.file(`ë‹¨í’ˆë“±ë¡_${safeFileName}.xls`, wbout);
  });

  zip.generateAsync({ type: "blob" }).then(content => {
    saveAs(content, "ë‹¨í’ˆë“±ë¡_ì „ì²´ë‹¤ìš´ë¡œë“œ.zip");
  });
}

// ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë¶„ë¦¬ í•¨ìˆ˜
function parseOptions(input) {
  if (!input || typeof input !== 'string') return [];
  return input.split(/[,/]/).map(s => s.trim()).filter(Boolean);
}
// ì˜µì…˜ ë…¸ì¶œ ë°©ì‹ í™•ì¸ í•¨ìˆ˜
function getOptionDisplayMode() {
  const selected = document.querySelector('input[name="optionDisplay"]:checked');
  return selected ? selected.value : "both";
} 


  // (1) ì˜µì…˜ êµ¬ì„± ë°©ì‹ ì ìš© í•¨ìˆ˜
function applyOptionMode(ì œí’ˆëª…, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìˆœë²ˆ) {
  const prefix = ìˆœë²ˆ ? `${ìˆœë²ˆ}) ` : "";
  let í…ìŠ¤íŠ¸ = `${prefix}${ì œí’ˆëª…}`;
  const mode = getOptionDisplayMode();

  if (mode === "both") {
    const parts = [];
    if (ìƒ‰ìƒ)  parts.push(ìƒ‰ìƒ);
    if (ì‚¬ì´ì¦ˆ) parts.push(ì‚¬ì´ì¦ˆ);
    if (parts.length) í…ìŠ¤íŠ¸ += ` / ${parts.join(" ")}`;  // ë¸”ë™ FREE
  }
  else if (mode === "colorOnly" && ìƒ‰ìƒ) {
    í…ìŠ¤íŠ¸ += ` / ${ìƒ‰ìƒ}`;
  }
  else if (mode === "sizeOnly" && ì‚¬ì´ì¦ˆ) {
    í…ìŠ¤íŠ¸ += ` / ${ì‚¬ì´ì¦ˆ}`;
  }

  return { ì œí’ˆì„ íƒ: í…ìŠ¤íŠ¸ };
}

  // (2) ì‚¬ì´ì¦ˆ expand í•¨ìˆ˜
  function expandSizes(sizeStr) {
    if (!sizeStr || typeof sizeStr !== "string") return [];
    if (sizeStr.includes(",") || sizeStr.includes("/")) {
      return sizeStr.split(/[,/]/).map(s => s.trim()).filter(Boolean);
    }
    const m = sizeStr.match(/^(\d{3})~(\d{3})$/);
    if (m) {
      const [start, end] = [parseInt(m[1],10), parseInt(m[2],10)];
      const out = [];
      for (let i = start; i <= end; i += 5) out.push(i.toString());
      return out;
    }
    return [sizeStr.trim()];
  }

// 2) íŒŒì¼ ì—…ë¡œë“œ ë¦¬ìŠ¤ë„ˆ
document.getElementById("inputFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(evt) {
    // 1) ì›Œí¬ë¶ íŒŒì‹±
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheetName = workbook.SheetNames.find(name =>
      name.includes("ìƒí’ˆ") || name.includes("ì˜µì…˜")
    ) || workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    if (!sheet) return alert("ìƒí’ˆì˜µì…˜ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

    // 2) JSON ë³€í™˜ â†’ í…Œì´ë¸” ì´ˆê¸°í™” â†’ addRow ë°˜ë³µ
    const json = XLSX.utils.sheet_to_json(sheet, { defval: "" });
    clearTable();
    json.forEach(row => addRow({
      ìƒí’ˆëª…: row["ìƒí’ˆëª…"],
      íŒë§¤ê°€: row["íŒë§¤ê°€"],
      ìƒ‰ìƒ: row["ìƒ‰ìƒ"],
      ì‚¬ì´ì¦ˆ: row["ì‚¬ì´ì¦ˆ"],
      ["1ë²ˆ ìƒí’ˆëª…"]: row["1ë²ˆ ìƒí’ˆëª…"],
      í’ˆì ˆëœì¡°í•©: row["í’ˆì ˆëœ ì¡°í•©"] || '',
      ì œì™¸: row["ì œì™¸"] === 'Y' || row["ì œì™¸"] === true
    }));

    // 3) í…Œì´ë¸”ì´ ì±„ì›Œì§„ ë’¤ì— originalDataì— ì €ì¥
    originalData = getDataFromTable();
  };

  reader.readAsArrayBuffer(file);
});



  </script>
</body>
</html>
