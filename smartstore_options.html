<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Pretendard', sans-serif; padding: 20px; background: #f5f6fa; color: #333; }
    .container { max-width: 100%; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.05); overflow-x: auto; }
    h1 { font-size: 24px; margin-bottom: 16px; }
    table { width: 100%; min-width: 1200px; border-collapse: collapse; margin: 10px 0; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; word-break: break-word; }
    th { background-color: #f0f0f0; }
    button, input[type="file"], input[type="text"] { margin: 4px; padding: 6px 12px; font-size: 14px; }
    input[type="checkbox"] { margin-right: 4px; }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ“ƒ ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì˜µì…˜ ìë™ ìƒì„±ê¸°</h1>
  <p style="font-size: 14px; color: #555; margin-bottom: 10px;">
    â€» ì‚¬ì´ì¦ˆ ì…ë ¥ ì•ˆë‚´: <br>
    - <strong>~</strong> ëŠ” 5ë‹¨ìœ„ ê°„ê²© ìë™ ìƒì„± (ì˜ˆ: <code>230~240</code> â†’ <code>230, 235, 240</code>)<br>
    - <strong>,</strong> ì™€ <strong>/</strong> ëŠ” ê°œë³„ ì‚¬ì´ì¦ˆ êµ¬ë¶„ìë¡œ ì‚¬ìš© (ì˜ˆ: <code>230,235/245</code>)<br>
  </p>
  <input type="file" id="inputFile" accept=".xls,.xlsx">
  <button onclick="downloadTemplate()">ì—‘ì…€ ì–‘ì‹ ë‹¤ìš´ë¡œë“œ</button>
  <!-- ì˜µì…˜ ì„ íƒ ë¼ë””ì˜¤ ë²„íŠ¼ ì¶”ê°€ -->
<p style="font-size: 14px; color: #555; margin-bottom: 10px;">
  ì˜µì…˜ ë…¸ì¶œ ë°©ì‹:
  <label><input type="radio" name="optionDisplay" value="both" checked> ìƒ‰ìƒ&ì‚¬ì´ì¦ˆ ëª¨ë‘ë…¸ì¶œ</label>
  <label><input type="radio" name="optionDisplay" value="colorOnly"> ìƒ‰ìƒë§Œ</label>
  <label><input type="radio" name="optionDisplay" value="sizeOnly"> ì‚¬ì´ì¦ˆë§Œ</label>
</p>
  <br>
  <table id="inputTable">
    <thead>
      <tr>
        <th>ëŒ€í‘œ</th><th>ìƒí’ˆëª…</th><th>íŒë§¤ê°€</th><th>ìƒ‰ìƒ</th><th>ì‚¬ì´ì¦ˆ</th>
        <th>1ë²ˆ ìƒí’ˆëª…</th><th>í’ˆì ˆëœ ì¡°í•©</th><th>ì œì™¸</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addRow()">+ í–‰ ì¶”ê°€</button>
  <button onclick="clearTable()">ì´ˆê¸°í™”</button>
  <br>
  <button onclick="downloadRepresentative()">ëŒ€í‘œìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  <button onclick="generateZip()">ì¼ê´„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ZIP)</button>
  <button onclick="downloadAddProductExcel()">ì¶”ê°€ìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  <button onclick="downloadSingleProductExcel()">ë‹¨í’ˆë“±ë¡ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  <button onclick="downloadSingleProductExcelAll()">ë‹¨í’ˆë“±ë¡ ì—‘ì…€ ì „ì²´ë‹¤ìš´ë¡œë“œ</button>
</div>

  <script>
    document.getElementById("inputFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(evt) {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets["ìƒí’ˆì˜µì…˜"] || workbook.Sheets[workbook.SheetNames[0]];
        if (!sheet) return alert("ìƒí’ˆì˜µì…˜ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        const json = XLSX.utils.sheet_to_json(sheet);
        clearTable();
        json.forEach(row => addRow({
          ìƒí’ˆëª…: row["ìƒí’ˆëª…"], íŒë§¤ê°€: row["íŒë§¤ê°€"], ìƒ‰ìƒ: row["ìƒ‰ìƒ"], ì‚¬ì´ì¦ˆ: row["ì‚¬ì´ì¦ˆ"],
          ["1ë²ˆ ìƒí’ˆëª…"]: row["1ë²ˆ ìƒí’ˆëª…"], í’ˆì ˆëœì¡°í•©: row["í’ˆì ˆëœ ì¡°í•©"] || '', ì œì™¸: row["ì œì™¸"] === 'Y' || row["ì œì™¸"] === true
        }));
      };
      reader.readAsArrayBuffer(file);
    });

    function addRow(data = {}) {
      const tbody = document.querySelector("#inputTable tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="radio" name="ëŒ€í‘œ"></td>
        <td><input value="${data.ìƒí’ˆëª… || ''}"></td>
        <td><input value="${data.íŒë§¤ê°€ || ''}" type="number"></td>
        <td><input value="${data.ìƒ‰ìƒ || ''}"></td>
        <td><input value="${data.ì‚¬ì´ì¦ˆ || ''}"></td>
        <td><input value="${data["1ë²ˆ ìƒí’ˆëª…"] || ''}"></td>
        <td><input value="${data.í’ˆì ˆëœì¡°í•© || ''}"></td>
        <td><input type="checkbox" ${data.ì œì™¸ ? 'checked' : ''}></td>
      `;
      tbody.appendChild(row);
    }

    function clearTable() {
      document.querySelector("#inputTable tbody").innerHTML = '';
    }

    function getDataFromTable() {
  const rows = document.querySelectorAll("#inputTable tbody tr");
  return Array.from(rows).map(row => {
    const cells = row.querySelectorAll("input");
    return {
      ëŒ€í‘œ: cells[0]?.checked ?? false,
      ìƒí’ˆëª…: cells[1]?.value?.trim() || "",
      íŒë§¤ê°€: parseInt(cells[2]?.value) || 0,
      ìƒ‰ìƒ: cells[3]?.value?.trim() || "",
      ì‚¬ì´ì¦ˆ: cells[4]?.value?.trim() || "",
      ["1ë²ˆ ìƒí’ˆëª…"]: cells[5]?.value?.trim() || "",
      í’ˆì ˆëœì¡°í•©: cells[6]?.value?.trim() || "",
      ì œì™¸: cells[7]?.checked ?? false
    };
  });
}

    function downloadTemplate() {
      const headers = ["ìƒí’ˆëª…","íŒë§¤ê°€","ìƒ‰ìƒ","ì‚¬ì´ì¦ˆ","1ë²ˆ ìƒí’ˆëª…","í’ˆì ˆëœ ì¡°í•©","ì œì™¸"];
      const ws = XLSX.utils.aoa_to_sheet([headers]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "ìƒí’ˆì˜µì…˜");
      const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
      saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ìŠ¤ìŠ¤_ì˜µì…˜ì–‘ì‹.xlsx`);
    }

// ëŒ€í‘œìƒí’ˆ ê¸°ì¤€ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (í™•ì¥ ì‚¬ì´ì¦ˆ ì ìš©)
function downloadRepresentative() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  if (!ëŒ€í‘œ) return alert("ëŒ€í‘œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");

  const ëŒ€í‘œíŒë§¤ê°€ = ëŒ€í‘œ.íŒë§¤ê°€;
  const ëŒ€í‘œìƒí’ˆëª… = ëŒ€í‘œ.ìƒí’ˆëª…;
  const mode = getOptionDisplayMode();

  const items = rows
    .filter(r => !r.ì œì™¸)
    .sort((a, b) => (a === ëŒ€í‘œ ? -1 : b === ëŒ€í‘œ ? 1 : 0));

  let index = 1;
  const data = [];

  items.forEach(item => {
    const ìˆœë²ˆ = index < 10 ? `0${index}` : `${index}`;
    const isëŒ€í‘œ = item === ëŒ€í‘œ;

    const ìƒí’ˆì´ë¦„ = isëŒ€í‘œ
      ? (item["1ë²ˆ ìƒí’ˆëª…"] && item["1ë²ˆ ìƒí’ˆëª…"] !== item.ìƒí’ˆëª…
          ? `${item.ìƒí’ˆëª….split(' ')[0]} ${item["1ë²ˆ ìƒí’ˆëª…"]}`
          : item.ìƒí’ˆëª…)
      : item.ìƒí’ˆëª…;

    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);
    const í’ˆì ˆì¡°í•© = parseOptions(item.í’ˆì ˆëœì¡°í•©);
    const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length > 0 ? ìƒ‰ìƒëª©ë¡ : [""];

    ìƒ‰ìƒë°°ì—´.forEach(color => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
        const base = applyOptionMode(ìƒí’ˆì´ë¦„, color, null, ìƒí’ˆì´ë¦„, ìˆœë²ˆ);
        data.push({
          ...base,
          ì˜µì…˜ê°€: isëŒ€í‘œ ? 0 : item.íŒë§¤ê°€ - ëŒ€í‘œíŒë§¤ê°€,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          const í’ˆì ˆ =
            í’ˆì ˆì¡°í•©.includes(color) ||
            í’ˆì ˆì¡°í•©.includes(size) ||
            í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
          const base = applyOptionMode(ìƒí’ˆì´ë¦„, color, size, ìƒí’ˆì´ë¦„, ìˆœë²ˆ);
          data.push({
            ...base,
            ì˜µì…˜ê°€: isëŒ€í‘œ ? 0 : item.íŒë§¤ê°€ - ëŒ€í‘œíŒë§¤ê°€,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        });
      }
    });

    index++;
  });

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `${ëŒ€í‘œìƒí’ˆëª…}.xls`);
}

// ì¼ê´„ ì—‘ì…€ ZIP ë‹¤ìš´ë¡œë“œ (í™•ì¥ ì‚¬ì´ì¦ˆ ì ìš©)
function generateZip() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  const mode = getOptionDisplayMode();

  const zip = new JSZip();

  rows.forEach(targetItem => {
    const ëŒ€í‘œíŒë§¤ê°€ = targetItem.íŒë§¤ê°€;
    const ëŒ€í‘œìƒí’ˆëª… = (targetItem.ìƒí’ˆëª… || "").replace(/[\\/:*?"<>|]/g, "");

    const items = rows
      .filter(r => !r.ì œì™¸)
      .sort((a, b) => (a === targetItem ? -1 : b === targetItem ? 1 : 0));

    let index = 1;
    const data = [];

    items.forEach(item => {
      const ìˆœë²ˆ = index < 10 ? `0${index}` : `${index}`;
      const isëŒ€í‘œ = item === targetItem;

      const ìƒí’ˆì´ë¦„ = isëŒ€í‘œ
        ? (item["1ë²ˆ ìƒí’ˆëª…"] && item["1ë²ˆ ìƒí’ˆëª…"] !== item.ìƒí’ˆëª…
            ? `${item.ìƒí’ˆëª….split(' ')[0]} ${item["1ë²ˆ ìƒí’ˆëª…"]}`
            : item.ìƒí’ˆëª…)
        : item.ìƒí’ˆëª…;

      const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ);
      const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);
      const í’ˆì ˆì¡°í•© = parseOptions(item.í’ˆì ˆëœì¡°í•©);
      const ìƒ‰ìƒë°°ì—´ = ìƒ‰ìƒëª©ë¡.length > 0 ? ìƒ‰ìƒëª©ë¡ : [""];

      ìƒ‰ìƒë°°ì—´.forEach(color => {
        if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
          const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
          const base = applyOptionMode(ìƒí’ˆì´ë¦„, color, null, ìƒí’ˆì´ë¦„, ìˆœë²ˆ);
          data.push({
            ...base,
            ì˜µì…˜ê°€: isëŒ€í‘œ ? 0 : item.íŒë§¤ê°€ - ëŒ€í‘œíŒë§¤ê°€,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        } else {
          ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
            const í’ˆì ˆ =
              í’ˆì ˆì¡°í•©.includes(color) ||
              í’ˆì ˆì¡°í•©.includes(size) ||
              í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);
            const base = applyOptionMode(ìƒí’ˆì´ë¦„, color, size, ìƒí’ˆì´ë¦„, ìˆœë²ˆ);
            data.push({
              ...base,
              ì˜µì…˜ê°€: isëŒ€í‘œ ? 0 : item.íŒë§¤ê°€ - ëŒ€í‘œíŒë§¤ê°€,
              ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
              ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…,
              ì‚¬ìš©ì—¬ë¶€: "Y"
            });
          });
        }
      });

      index++;
    });

    if (data.length > 0) {
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "ì˜µì…˜ë°ì´í„°");
      const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
      zip.file(`${ëŒ€í‘œìƒí’ˆëª…}.xls`, wbout);
    }
  });

  zip.generateAsync({ type: "blob" }).then(content => {
    saveAs(content, "ì˜µì…˜_ì¼ê´„ë‹¤ìš´ë¡œë“œ.zip");
  });
}

    // ì¶”ê°€ìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
// ì¶”ê°€ìƒí’ˆ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ëª¨ë“  ì œì™¸ë˜ì§€ ì•Šì€ ìƒí’ˆ í¬í•¨)
function downloadAddProductExcel() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  if (!ëŒ€í‘œ) return alert("ëŒ€í‘œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");

  const ëŒ€í‘œìƒí’ˆëª… = ëŒ€í‘œ.ìƒí’ˆëª…;
  const items = rows
    .filter(r => !r.ì œì™¸)
    .sort((a, b) => (a === ëŒ€í‘œ ? -1 : b === ëŒ€í‘œ ? 1 : 0));

  let index = 1;
  const data = [];

  items.forEach(item => {
    const ìˆœë²ˆ = index < 10 ? `0${index}` : `${index}`;
    const ìƒ‰ìƒëª©ë¡ = parseOptions(item.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(item.ì‚¬ì´ì¦ˆ);

    ìƒ‰ìƒëª©ë¡.forEach(color => {
      ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
        data.push({
          ì¶”ê°€ìƒí’ˆëª…: "ì œí’ˆì„ íƒ",
          ì¶”ê°€ìƒí’ˆê°’: `${ìˆœë²ˆ}) ${item.ìƒí’ˆëª…} / ${color}`,
          ì¶”ê°€ìƒí’ˆê°€: item.íŒë§¤ê°€,
          ì¬ê³ ìˆ˜ëŸ‰: 99999,
          ì‚¬ìš©ì—¬ë¶€: "Y",
          ê´€ë¦¬ì½”ë“œ: item.ìƒí’ˆëª…
        });
      });
    });

    index++;
  });

  if (data.length === 0) return alert("ì¶”ê°€ìƒí’ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ì¶”ê°€ìƒí’ˆ");
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ì¶”ê°€ìƒí’ˆ_${ëŒ€í‘œìƒí’ˆëª…}.xls`);
}

// ë‹¨í’ˆë“±ë¡ìš© ì—‘ì…€ ë‹¤ìš´ë¡œë“œ - ëŒ€í‘œìƒí’ˆë§Œ ìˆœë²ˆ ì—†ì´ ì¶œë ¥  
function downloadSingleProductExcel() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  const ëŒ€í‘œ = rows.find(r => r.ëŒ€í‘œ) || rows[0];
  if (!ëŒ€í‘œ) return alert("ëŒ€í‘œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");

  const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
  const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
  const í’ˆì ˆì¡°í•© = (ëŒ€í‘œ.í’ˆì ˆëœì¡°í•© || '').split(/[,/\n]/).map(s => s.trim());
  const ìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;

  const mode = getOptionDisplayMode();  // ì˜µì…˜ ë…¸ì¶œ ë°©ì‹
  const data = [];

  ìƒ‰ìƒëª©ë¡.forEach(color => {
    if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
      const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
      data.push({
        ì œí’ˆì„ íƒ: ìƒí’ˆëª…,
        ìƒ‰ìƒ: color,
        ì˜µì…˜ê°€: 0,
        ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
        ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
        ì‚¬ìš©ì—¬ë¶€: "Y"
      });
    } else {
      ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
        const í’ˆì ˆ =
          í’ˆì ˆì¡°í•©.includes(color) ||
          í’ˆì ˆì¡°í•©.includes(size) ||
          í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);

      if (mode === "colorOnly") {
        data.push({
          ì œí’ˆì„ íƒ: ìƒí’ˆëª…,
          ìƒ‰ìƒ: color,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else if (mode === "sizeOnly") {
        data.push({
          ì œí’ˆì„ íƒ: ìƒí’ˆëª…,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else {
        data.push({
          ì œí’ˆì„ íƒ: `${ìƒí’ˆëª…} / ${color}`,
          ì‚¬ì´ì¦ˆ: size,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      }
    } else {
      ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
        const í’ˆì ˆ =
          í’ˆì ˆì¡°í•©.includes(color) ||
          í’ˆì ˆì¡°í•©.includes(size) ||
          í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);

        if (mode === "colorOnly") {
          data.push({
            ì œí’ˆì„ íƒ: ìƒí’ˆëª…,
            ìƒ‰ìƒ: color,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        } else if (mode === "sizeOnly") {
          data.push({
            ì œí’ˆì„ íƒ: `${ìƒí’ˆëª…} / ${size}`,
            ì‚¬ì´ì¦ˆ: size,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        } else {
          data.push({
            ì œí’ˆì„ íƒ: `${ìƒí’ˆëª…} / ${color}`,
            ì‚¬ì´ì¦ˆ: size,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        }
      });
    }
  });

  // ìƒ‰ìƒ ì—´ ì œê±° ì¡°ê±´: ì‚¬ì´ì¦ˆê°€ ìˆì„ ë•Œë§Œ ì œê±°
  // ë¶ˆí•„ìš”í•œ ì—´ ì œê±°
  const hasSize = data.some(row => row.ì‚¬ì´ì¦ˆ);
  if (hasSize) {
  if (mode !== "colorOnly") {
    data.forEach(row => delete row.ìƒ‰ìƒ);
  }
  if (mode === "sizeOnly") {
    data.forEach(row => delete row.ìƒ‰ìƒ);
  }
  if (!hasSize && mode !== "sizeOnly") {
    data.forEach(row => delete row.ì‚¬ì´ì¦ˆ);
  }

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
  const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
  saveAs(new Blob([wbout], { type: "application/octet-stream" }), `ë‹¨í’ˆë“±ë¡_${ëŒ€í‘œ.ìƒí’ˆëª…}.xls`);
}
  

// ë‹¨í’ˆë“±ë¡ìš© ì „ì²´ ì—‘ì…€ ZIP ë‹¤ìš´ë¡œë“œ
function downloadSingleProductExcelAll() {
  const rows = getDataFromTable().filter(r => !r.ì œì™¸);
  if (rows.length === 0) return alert("ì¶œë ¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
  const zip = new JSZip();

  const zip = new JSZip();
  const mode = getOptionDisplayMode();  // ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ì¶œë ¥ ë°©ì‹
  const ê·¸ë£¹ë“¤ = [...new Set(rows.map(r => r.ìƒí’ˆëª…))];

  ê·¸ë£¹ë“¤.forEach(ìƒí’ˆëª… => {
    const ê·¸ë£¹ = rows.filter(r => r.ìƒí’ˆëª… === ìƒí’ˆëª… && !r.ì œì™¸);
    const ëŒ€í‘œ = ê·¸ë£¹.find(r => r.ëŒ€í‘œ) || ê·¸ë£¹[0];

    const ìƒ‰ìƒëª©ë¡ = parseOptions(ëŒ€í‘œ.ìƒ‰ìƒ);
    const ì‚¬ì´ì¦ˆëª©ë¡ = expandSizes(ëŒ€í‘œ.ì‚¬ì´ì¦ˆ);
    const í’ˆì ˆì¡°í•© = (ëŒ€í‘œ.í’ˆì ˆëœì¡°í•© || '').split(/[,/\n]/).map(s => s.trim());
    const ëŒ€í‘œìƒí’ˆëª… = ëŒ€í‘œ["1ë²ˆ ìƒí’ˆëª…"] || ëŒ€í‘œ.ìƒí’ˆëª…;

    const data = [];

    ìƒ‰ìƒëª©ë¡.forEach(color => {
      if (ì‚¬ì´ì¦ˆëª©ë¡.length === 0) {
        const í’ˆì ˆ = í’ˆì ˆì¡°í•©.includes(color);
        data.push({
          ì œí’ˆì„ íƒ: ëŒ€í‘œìƒí’ˆëª…,
          ìƒ‰ìƒ: color,
          ì˜µì…˜ê°€: 0,
          ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
          ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
          ì‚¬ìš©ì—¬ë¶€: "Y"
        });
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          const í’ˆì ˆ =
            í’ˆì ˆì¡°í•©.includes(color) ||
            í’ˆì ˆì¡°í•©.includes(size) ||
            í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);

        if (mode === "colorOnly") {
          data.push({
            ì œí’ˆì„ íƒ: ëŒ€í‘œìƒí’ˆëª…,
            ìƒ‰ìƒ: color,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        } else if (mode === "sizeOnly") {
          data.push({
            ì œí’ˆì„ íƒ: ëŒ€í‘œìƒí’ˆëª…,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        } else {
          data.push({
            ì œí’ˆì„ íƒ: `${ëŒ€í‘œìƒí’ˆëª…} / ${color}`,
            ì‚¬ì´ì¦ˆ: size,
            ì˜µì…˜ê°€: 0,
            ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
            ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
            ì‚¬ìš©ì—¬ë¶€: "Y"
          });
        }
      } else {
        ì‚¬ì´ì¦ˆëª©ë¡.forEach(size => {
          const í’ˆì ˆ =
            í’ˆì ˆì¡°í•©.includes(color) ||
            í’ˆì ˆì¡°í•©.includes(size) ||
            í’ˆì ˆì¡°í•©.includes(`${color}-${size}`);

          if (mode === "colorOnly") {
            data.push({
              ì œí’ˆì„ íƒ: ëŒ€í‘œìƒí’ˆëª…,
              ìƒ‰ìƒ: color,
              ì˜µì…˜ê°€: 0,
              ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
              ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
              ì‚¬ìš©ì—¬ë¶€: "Y"
            });
          } else if (mode === "sizeOnly") {
            data.push({
              ì œí’ˆì„ íƒ: `${ëŒ€í‘œìƒí’ˆëª…} / ${size}`,
              ì‚¬ì´ì¦ˆ: size,
              ì˜µì…˜ê°€: 0,
              ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
              ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
              ì‚¬ìš©ì—¬ë¶€: "Y"
            });
          } else {
            data.push({
              ì œí’ˆì„ íƒ: `${ëŒ€í‘œìƒí’ˆëª…} / ${color}`,
              ì‚¬ì´ì¦ˆ: size,
              ì˜µì…˜ê°€: 0,
              ì¬ê³ ìˆ˜ëŸ‰: í’ˆì ˆ ? 0 : 99999,
              ê´€ë¦¬ì½”ë“œ: ëŒ€í‘œ.ìƒí’ˆëª…,
              ì‚¬ìš©ì—¬ë¶€: "Y"
            });
          }
        });
      }
    });

    if (data.length > 0) {
      // ì—´ ì •ë¦¬
      const hasSize = data.some(row => row.ì‚¬ì´ì¦ˆ);
      if (hasSize) {
      if (mode !== "colorOnly") {
        data.forEach(row => delete row.ìƒ‰ìƒ);
      }
      if (mode === "sizeOnly") {
        data.forEach(row => delete row.ìƒ‰ìƒ);
      }
      if (!hasSize && mode !== "sizeOnly") {
        data.forEach(row => delete row.ì‚¬ì´ì¦ˆ);
      }

      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "ë‹¨í’ˆì˜µì…˜");
      const wbout = XLSX.write(wb, { bookType: 'xls', type: 'array' });
      zip.file(`ë‹¨í’ˆë“±ë¡_${ëŒ€í‘œ.ìƒí’ˆëª…}.xls`, wbout);
    }
  });

  zip.generateAsync({ type: "blob" }).then(content => {
    saveAs(content, "ë‹¨í’ˆë“±ë¡_ì „ì²´ë‹¤ìš´ë¡œë“œ.zip");
  });
}

// ì‚¬ì´ì¦ˆ ìë™ í™•ì¥ í•¨ìˆ˜ (ì˜ˆ: 230~250 -> 230, 235, 240, 245, 250)
function expandSizes(input) {
  if (!input) return [];
  return input.split(/[,/]/).flatMap(part => {
    part = part.trim();
    const match = part.match(/^(\d{2,3})~(\d{2,3})$/);
    if (match) {
      const [start, end] = part.split('~').map(Number);
      const sizes = [];
      for (let i = start; i <= end; i += 5) sizes.push(i.toString());
      return sizes;
    }
    return [part];
  }).filter(Boolean);
}

// ìƒ‰ìƒ/ì‚¬ì´ì¦ˆ ë¶„ë¦¬ í•¨ìˆ˜
function parseOptions(input) {
  if (!input) return [];
  return input.split(/[,/]/).map(s => s.trim()).filter(Boolean);
}
// ì˜¤ë¥˜ìˆ˜ì •ìš© ì½”ë“œ
    function getOptionDisplayMode() {
  const selected = document.querySelector('input[name="optionDisplay"]:checked');
  return selected ? selected.value : "both";
}
// ì˜¤ë¥˜ìˆ˜ì •ìš© ì½”ë“œ
function applyOptionMode(ì œí’ˆëª…, ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ìƒí’ˆëª…, ìˆœë²ˆ) {
  const mode = getOptionDisplayMode();
  let ì œí’ˆì„ íƒê°’ = `${ìˆœë²ˆ}) ${ì œí’ˆëª…}`;
  let ìƒ‰ìƒì—´ = ìƒ‰ìƒ || "";
  let ì‚¬ì´ì¦ˆì—´ = ì‚¬ì´ì¦ˆ || "";

  if (mode === "colorOnly") {
    return { ì œí’ˆì„ íƒ: ì œí’ˆì„ íƒê°’, ìƒ‰ìƒ: ìƒ‰ìƒì—´ };
  } else if (mode === "sizeOnly") {
    ì œí’ˆì„ íƒê°’ += ì‚¬ì´ì¦ˆ ? ` / ${ì‚¬ì´ì¦ˆ}` : "";
    return { ì œí’ˆì„ íƒ: ì œí’ˆì„ íƒê°’, ì‚¬ì´ì¦ˆ: ì‚¬ì´ì¦ˆì—´ };
  } else {
    ì œí’ˆì„ íƒê°’ += ìƒ‰ìƒ ? ` / ${ìƒ‰ìƒ}` : "";
    return ì‚¬ì´ì¦ˆ
      ? { ì œí’ˆì„ íƒ: ì œí’ˆì„ íƒê°’, ì‚¬ì´ì¦ˆ: ì‚¬ì´ì¦ˆì—´ }
      : { ì œí’ˆì„ íƒ: ì œí’ˆì„ íƒê°’ };
  }
}

  </script>
</body>
</html>
